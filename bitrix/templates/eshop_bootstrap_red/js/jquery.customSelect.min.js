(function(e){function o(t,n){var r=this,i,s,o,u;r.options.customRange?(i=r.options.customRangeHelper(n[0],n[1]),o=i[0],s=i[1]):o=s=n,r._setWindowText(s),r.userCustomValue=o,u=e('<option data-custom="true" value="'+o+'">'+s+"</option>"),r.element.find("option[data-custom]").remove(),r.element.append(u.attr("selected",!0)).trigger("change",t),r._trigger("change",t),r.root.find("input:checked").attr("checked",!1)}var t="ui-customSelect-open",n="ui-customRange-disabled",r="customselect",i,s;e.widget("ui.customSelect",{options:{placeholder:"Please select some items",defaultValue:null,customRange:!1,customValue:!1,customValuePlaceholder:"custom value",customRanges:null,windowFormatter:function(e){return e},customRangeHelper:function(e,t){var n,r;return e&&t?(n=e+"-"+t,r=e==t?e:e+" to "+t):e&&!t?(n=e+"p",r=e+"+"):!e&&t&&(n="0-"+t,r="0 to "+t),[n,r]},reverseRangeHelper:function(e){if(e.match(/^\d+-\d+$/))return e.split("-");if(e.match(/^\d+p$/))return[e.match(/^(\d+)p$/)[1],""]}},_create:function(){var o=this,u=o.options,a=u.defaultValue,f=this.element,l,c,h=!1;if(!f.is("select"))throw new TypeError("jquery.customSelect expects a <select> element.");o.userCustomValue=null,o.rootId=f.attr("id")+"_customSelect",c=['<div class="ui-customSelect">','  <div class="ui-customSelect-window"><span></span>','    <div class="ui-customSelect-arrow ui-customSelect-downArrow">&#x25BC;</div>','    <div class="ui-customSelect-arrow ui-customSelect-upArrow">&#x25B2;</div>',"  </div>",'  <div class="ui-customSelect-dropdown"><ul></ul></div>',"</div>"],this.root=l=e(c.join("")).attr("id",o.rootId),f.after(l).hide(),this.window=l.find(".ui-customSelect-window span"),this.list=l.find("ul"),o._createFromSelect(),o._setWindowText(),o.window.parent().click(function(e){o._trigger(h?"blur":"focus",e)}),l.delegate("li>input","change",function(t){o.userCustomValue=null,o._setWindowText(),f.val(o.getVal()).trigger("change"),o._trigger("change",t,{element:this,value:this.value}),e(".ui-customSelect-rangeContainer input, .ui-customSelect-customValue").val(""),e(".ui-customSelect-error").hide(),o.userCustomValue=null}),f.on(r+"focus",function(){l.hasClass(n)||(h=!0,l.addClass(t),e(document).on("click.customRange"+o.rootId,function(t){e.contains(l[0],t.target)||o._trigger("blur")}))}).on(r+"blur",function(){e(document).off("click.customRange"+o.rootId),h=!1,l.removeClass(t)}).on(r+"disabled",function(){l.addClass(n),h&&o._trigger("blur")}).on(r+"enabled",function(){l.removeClass(n)});if(o.isMultiple&&a){function p(){o.getVal().length||o.list.find("input[value="+a+"]").attr("checked",!0).change()}f.on(r+"change",p),p()}!o.isMultiple&&(u.customRange||u.customValue)&&(o.setCustomValueError=function(e){l.find(".ui-customSelect-error").show().html(e)},u.customRange?i.call(o,l,this.list,u):u.customValue&&s.call(o,l,this.list,u))},setVal:function(e){var t=this.element.find("option[value="+e+"]"),n;t.length&&!t[0].attributes["data-custom"]?(this.element.val(e),this.reload(),this._setWindowText()):this.options.customRange?(n=this.options.reverseRangeHelper(e),this.root.find(".ui-customSelect-min").val(n[0]),this.root.find(".ui-customSelect-max").val(n[1]),o.call(this,null,n)):this.options.customValue&&(this.root.find(".ui-customSelect-customValue").val(e),o.call(this,null,e))},getVal:function(){if(this.userCustomValue!==null)return this.userCustomValue;var e=this.root.find("li>input:checked").map(function(){return this.value}).toArray();return e.length?e[this.isMultiple?"slice":"pop"]():this.isMultiple?[]:null},friendlyVal:function(){return this.root.find("input:checked+label").map(function(){return this.innerHTML}).toArray()},_setWindowText:function(e){var t;e||(t=this.friendlyVal(),e=t.length?t.join(", "):this.options.placeholder),this.window.html(this.options.windowFormatter(e))},_createFromSelect:function(){var t=this,n=0,r=t.list,i=r.prev()[0]||r.parent();t.isMultiple=t.element.attr("multiple"),r.empty(),this.element.children().each(function(){var i=this,s=t.rootId+"_"+n++,o='<label for="'+s+'">'+i.innerHTML+"</label>",u;t.isMultiple?u=e('<input id="'+s+'" type="checkbox" value="'+i.value+'">'):u=e('<input id="'+s+'" name="'+t.rootId+'_radio" type="radio" value="'+i.value+'">'),r.append(e("<li></li>").append(u).append(" ").append(o)),i.selected&&u.attr("checked",!0)})},reload:function(){this.element.find("option[data-custom]").remove(),this.root.find("input[type='text']").val("").blur(),this.userCustomValue=null,this._createFromSelect()},_setOption:function(e,t){e==="disabled"&&this._trigger((t?"dis":"en")+"abled")},destroy:function(){e.Widget.prototype.destroy.apply(this,arguments),e(document).off("click.customRange"+this.rootId),this.root.remove(),this.element.show()}}),s=function(t,n,r){function a(t){var n=u.val();i._trigger("customvaluechange",t,{value:n,widget:i})&&(e(".ui-customSelect-error").hide(),o.call(i,t,n),i._trigger("blur"))}var i=this,s=r.customValue,u;n.before(e(['<div class="ui-customSelect-customValueContainer">','  <input class="ui-customSelect-customValue" type="text" placeholder="'+r.customValuePlaceholder+'" />','  <div style="display: none" class="ui-customSelect-error"></div>',"</div>"].join(""))),u=t.find(".ui-customSelect-customValue");if(typeof s=="string"||typeof s=="number")u.val(s),a();u.keydown(function(e){e.which===13&&a(e)})},i=function(t,n,r){function l(t){var n=u.val(),r=a.val(),i={min:n,max:r,widget:f},s,l;isNaN(n)||isNaN(r)?f.setCustomValueError("Please enter only numbers."):n&&r&&n>r?f.setCustomValueError("Min cannot be bigger than max."):f._trigger("rangechange",t,i)&&(e(".ui-customSelect-error").hide(),o.call(f,t,[n,r]),f._trigger("blur"))}var i,s,u,a,f=this;i=['<div class="ui-customSelect-rangeContainer">','  <input type="text" class="ui-customSelect-min" placeholder="min" /> to &nbsp;<input type="text" class="ui-customSelect-max" placeholder="max" />','  <div style="display: none" class="ui-customSelect-error"></div>',"</div>"],n.after(e(i.join(""))),u=t.find(".ui-customSelect-min"),a=t.find(".ui-customSelect-max"),s=t,r.customRanges&&(u.val(r.customRanges.min),a.val(r.customRanges.max),l()),u.add(a).keydown(function(e){e.which===13&&l(e)})}})(jQuery);