var ECUserControll=function(e){this.oEC=e.oEC;var t=this;this.count=0;this.countAgr=0;this.countDec=0;this.bEditMode=e.view!==true;this.pAttendeesCont=e.AttendeesCont;this.pAttendeesList=e.AttendeesList;this.pParamsCont=e.AdditionalParams;this.pSummary=e.SummaryCont;this.pCount=this.pSummary.appendChild(BX.create("A",{props:{className:"bxc-count",href:"javascript:void(0)"}}));this.pCountArg=this.pSummary.appendChild(BX.create("A",{props:{className:"bxc-count-agr",href:"javascript:void(0)"}}));this.pCountDec=this.pSummary.appendChild(BX.create("A",{props:{className:"bxc-count-dec",href:"javascript:void(0)"}}));this.pCount.onclick=function(){t.ListMode("all")};this.pCountArg.onclick=function(){t.ListMode("agree")};this.pCountDec.onclick=function(){t.ListMode("decline")};this._getFromDate=e.fromDateGetter&&typeof e.fromDateGetter=="function"?e.fromDateGetter:function(){return false};this._getToDate=e.toDateGetter&&typeof e.toDateGetter=="function"?e.toDateGetter:function(){return false};this._getEventId=e.eventIdGetter&&typeof e.eventIdGetter=="function"?e.eventIdGetter:function(){return false};this.ListMode("all");this.Attendees={};if(this.bEditMode){this.pLinkCont=e.AddLinkCont;var i=this.pLinkCont.appendChild(BX.create("I")),s=this.pLinkCont.appendChild(BX.create("SPAN",{text:EC_MESS.AddAttendees}));i.onclick=s.onclick=BX.proxy(this.OpenSelectUser,this);var o=[{text:EC_MESS.AddGuestsDef,onclick:BX.proxy(this.OpenSelectUser,this)}];if(!this.oEC.bExtranet&&this.oEC.type=="group")o.push({text:EC_MESS.AddGroupMemb,title:EC_MESS.AddGroupMembTitle,onclick:BX.proxy(this.oEC.AddGroupMembers,this.oEC)});if(o.length>1){pMore=this.pLinkCont.appendChild(BX.create("A",{props:{href:"javascript: void(0);",className:"bxec-add-more"}}));pMore.onclick=function(){BX.PopupMenu.show("bxec_add_guest_menu",t.pLinkCont,o,{events:{onPopupClose:function(){BX.removeClass(pMore,"bxec-add-more-over")}}});BX.addClass(pMore,"bxec-add-more-over")}}BX.addCustomEvent(window,"onUserSelectorOnChange",BX.proxy(this.UserOnChange,this))}};ECUserControll.prototype={SetValues:function(e){var t,i=e.length,s;BX.cleanNode(this.pAttendeesList);this.Attendees={};this.count=0;this.countAgr=0;this.countDec=0;for(t=0;t<i;t++){s=e[t];s.key=s.id||s.email;if(s&&s.key&&!this.Attendees[s.key])this.DisplayAttendee(s)}if(this.bEditMode){this.DisableUserOnChange(true,true);O_BXCalUserSelect.setSelected(e)}this.UpdateCount()},GetValues:function(){return this.Attendees},SetEmpty:function(e){if(this.bEmpty===e)return;BX.onCustomEvent(this,"SetEmpty",[e]);if(e){BX.addClass(this.pAttendeesCont,"bxc-att-empty");if(this.pParamsCont)this.pParamsCont.style.display="none"}else{BX.removeClass(this.pAttendeesCont,"bxc-att-empty");if(this.pParamsCont)this.pParamsCont.style.display=""}this.bEmpty=e},UpdateCount:function(){this.pCount.innerHTML=EC_MESS.AttSumm+" - "+(parseInt(this.count)||0);if(this.countAgr>0){this.pCountArg.innerHTML=EC_MESS.AttAgr+" - "+parseInt(this.countAgr);this.pCountArg.style.display=""}else{this.pCountArg.style.display="none"}if(this.countDec>0){this.pCountDec.innerHTML=EC_MESS.AttDec+" - "+parseInt(this.countDec);this.pCountDec.style.display=""}else{this.pCountDec.style.display="none"}this.SetEmpty(this.count==0)},OpenSelectUser:function(e){if(BX.PopupMenu&&BX.PopupMenu.currentItem)BX.PopupMenu.currentItem.popupWindow.close();if(!e)e=window.event;if(!this.SelectUserPopup){var t=this;this.SelectUserPopup=BX.PopupWindowManager.create("bxc-user-popup",this.pLinkCont,{offsetTop:1,autoHide:true,closeByEsc:true,content:BX("BXCalUserSelect_selector_content"),className:"bxc-popup-user-select",buttons:[new BX.PopupWindowButton({text:EC_MESS.Add,events:{click:function(){t.SelectUserPopup.close();for(var e in t.selectedUsers){e=parseInt(e);if(!isNaN(e)&&e>0){if(!t.Attendees[e]&&t.selectedUsers[e]){t.selectedUsers[e].key=e;t.DisplayAttendee(t.selectedUsers[e])}else if(t.Attendees[e]&&!t.selectedUsers[e]){t.RemoveAttendee(e,false)}}}BX.onCustomEvent(t,"UserOnChange");t.UpdateCount()}}}),new BX.PopupWindowButtonLink({text:EC_MESS.Close,className:"popup-window-button-link-cancel",events:{click:function(){t.SelectUserPopup.close()}}})]})}if(this.bEditMode){this.selectedUsers={};var i=[],s;for(s in this.Attendees){if(this.Attendees[s]&&this.Attendees[s].type!="ext")i.push(this.Attendees[s].User)}O_BXCalUserSelect.setSelected(i)}this.SelectUserPopup.show();BX.PreventDefault(e)},AddByEmail:function(e){var t=this;if(BX.PopupMenu&&BX.PopupMenu.currentItem)BX.PopupMenu.currentItem.popupWindow.close();if(!e)e=window.event;if(!this.EmailPopup){var i=BX.create("DIV",{props:{className:"bxc-email-cont"},html:'<label class="bxc-email-label">'+EC_MESS.UserEmail+":</label>"});this.pEmailValue=i.appendChild(BX.create("INPUT",{props:{className:"bxc-email-input"}}));this.EmailPopup=BX.PopupWindowManager.create("bxc-user-popup-email",this.pLinkCont,{offsetTop:1,autoHide:true,content:i,className:"bxc-popup-user-select-email",closeIcon:{right:"12px",top:"5px"},closeByEsc:true,buttons:[new BX.PopupWindowButton({text:EC_MESS.Add,className:"popup-window-button-accept",events:{click:function(){var e=BX.util.trim(t.pEmailValue.value);if(e!=""&&!t.Attendees[e]){var i={name:e,key:e,type:"ext",status:"Y"};t.DisplayAttendee(i);t.UpdateCount()}t.EmailPopup.close()}}}),new BX.PopupWindowButtonLink({text:EC_MESS.Close,className:"popup-window-button-link-cancel",events:{click:function(){t.EmailPopup.close()}}})]})}this.EmailPopup.show();setTimeout(function(){BX.focus(t.pEmailValue)},50);BX.PreventDefault(e)},DisableUserOnChange:function(e,t){this.bDisableUserOnChange=e===true;if(t)setTimeout(BX.proxy(this.DisableUserOnChange,this),300)},UserOnChange:function(e){if(this.bDisableUserOnChange)return;this.selectedUsers=e},DisplayAttendee:function(e,t){this.count++;if(e.status=="Y")this.countAgr++;else if(e.status=="N")this.countDec++;else e.status="Q";if(t&&e.id&&this.Attendees[e.id]){}else{var i=this,s=false,o=e.status.toLowerCase(),n=this.pAttendeesList.appendChild(BX.create("SPAN",{props:{className:"bxc-attendee-row bxc-att-row-"+o}})),a=n.appendChild(BX.create("I",{props:{className:"bxc-stat-"+o,title:EC_MESS["GuestStatus_"+o]+(e.desc?" - "+e.desc:"")}}));if(e.type=="ext")pName=n.appendChild(BX.create("span",{props:{className:"bxc-name"},text:e.name||e.email}));else pName=n.appendChild(BX.create("A",{props:{href:this.oEC.GetUserHref(e.id),className:"bxc-name"},text:e.name}));if(this.bEditMode&&e.type!="ext")s=n.appendChild(BX.create("SPAN",{props:{className:"bxc-busy"}}));n.appendChild(BX.create("SPAN",{props:{className:"bxc-comma"},html:","}));if(this.bEditMode){n.appendChild(BX.create("A",{props:{id:"bxc-att-key-"+e.key,href:"javascript:void(0)",title:EC_MESS.Delete,className:"bxc-del-att"}})).onclick=function(e){i.RemoveAttendee(this.id.substr("bxc-att-key-".length));return BX.PreventDefault(e||window.event)}}this.Attendees[e.key]={User:e,pRow:n,pBusyCont:s}}},RemoveAttendee:function(e,t){t=t!==false;if(this.Attendees[e]){this.Attendees[e].pRow.parentNode.removeChild(this.Attendees[e].pRow);if(this.Attendees[e].User.status=="Y")this.countAgr--;if(this.Attendees[e].User.status=="N")this.countDec--;this.count--;this.Attendees[e]=null;delete this.Attendees[e];if(this.bEditMode){var i=[];for(k in this.Attendees){if(this.Attendees[k]&&this.Attendees[k].type!="ext")i.push(this.Attendees[k].User)}this.DisableUserOnChange(true,true);if(t)O_BXCalUserSelect.setSelected(i)}}this.UpdateCount()},ListMode:function(e){if(this.mode==e)return;if(this.mode){BX.removeClass(this.pAttendeesList,"bxc-users-mode-"+this.mode);BX.removeClass(this.pSummary,"bxc-users-mode-"+this.mode)}this.mode=e;BX.addClass(this.pAttendeesList,"bxc-users-mode-"+this.mode);BX.addClass(this.pSummary,"bxc-users-mode-"+this.mode)}};var ECBanner=function(e){var t=this;this.oEC=e;var i=false;this.pWnd=BX(this.oEC.id+"banner");this.pWnd.onmouseover=function(){if(t._sect_over_timeout){clearInterval(t._sect_over_timeout)}BX.addClass(t.pWnd,"bxec-hover")};this.pWnd.onmouseout=function(){t._sect_over_timeout=setTimeout(function(){BX.removeClass(t.pWnd,"bxec-hover")},100)};BX(this.oEC.id+"_ban_close").onclick=function(){t.Close();return false};if(this.oEC.bIntranet){this.pOutlSel=BX(e.id+"_outl_sel");if(this.pOutlSel&&this.pOutlSel.parentNode){if(BX.browser.IsMac()){BX.remove(this.pOutlSel.parentNode)}else{i=true;this.pOutlSel.parentNode.onclick=function(){t.ShowPopup("outlook")};this.pOutlSel.onmouseover=function(){BX.addClass(this,"bxec-ban-over")};this.pOutlSel.onmouseout=function(){BX.removeClass(this,"bxec-ban-over")}}}}if(this.oEC.bCalDAV){this.pMobSel=BX(e.id+"_mob_sel");if(this.pMobSel&&this.pMobSel.parentNode){i=true;this.pMobSel.parentNode.onclick=function(){t.ShowPopup("mobile")};this.pMobSel.onmouseover=function(){BX.addClass(this,"bxec-ban-over")};this.pMobSel.onmouseout=function(){BX.removeClass(this,"bxec-ban-over")}}}if(this.oEC.arConfig.bExchange){var s=BX(e.id+"_exch_sync");if(s){i=true;s.onclick=function(){t.oEC.SyncExchange();return false}}}if(!i){this.Close(false)}this.Popup={};if(!window.jsOutlookUtils)return BX.loadScript("/bitrix/js/calendar/outlook.js",t.outlookRun)};ECBanner.prototype={ShowPopup:function(e){var t=this;if(!this.Popup[e])this.CreatePopup(e);if(this.Popup[e].bShowed)return this.ClosePopup(e);this.ClosePopup(e);var i=this.Popup[e].pWin.Get();this.Popup[e].bShowed=true;var s=0,o,n=this.oEC.arSections.length,a,r,l;BX.cleanNode(i);if(e=="mobile"){s++;l=i.appendChild(BX.create("DIV",{props:{id:"ecpp_all",title:EC_MESS.AllCalendars},style:{backgroundColor:"#F2F8D6"},text:EC_MESS.AllCalendars,events:{mouseover:function(){BX.addClass(this,"bxec-over")},mouseout:function(){BX.removeClass(this,"bxec-over")}}}));l.onclick=function(){t.RunMobile(this.id.substr("ecpp_".length));t.ClosePopup()}}for(o=0;o<n;o++){a=this.oEC.arSections[o];if(!this.oEC.IsCurrentViewSect(a))continue;if(e=="outlook"&&!a.OUTLOOK_JS)continue;s++;l=i.appendChild(BX.create("DIV",{props:{id:"ecpp_"+a.ID,title:a.NAME,className:"bxec-text-overflow"+(a.bDark?" bxec-dark":"")},style:{backgroundColor:a.COLOR},text:a.NAME,events:{mouseover:function(){BX.addClass(this,"bxec-over")},mouseout:function(){BX.removeClass(this,"bxec-over")}}}));if(e=="outlook"){l.onclick=function(){t.RunOutlook(this.id.substr("ecpp_".length));t.ClosePopup()}}else if(e=="mobile"){l.onclick=function(){t.RunMobile(this.id.substr("ecpp_".length));t.ClosePopup()}}}if(!this.bCloseEventsAttached){BX.bind(document,"keyup",BX.proxy(this.OnKeyUp,this));setTimeout(function(){t.bPreventClickClosing=false;BX.bind(document,"click",BX.proxy(t.ClosePopup,t))},100);this.bCloseEventsAttached=true}var h=BX.pos(this.Popup[e].pSel);this.Popup[e].pWin.Show(true);i.style.width="200px";i.style.height="";i.style.left=h.left+0+"px";i.style.top=h.bottom+0+"px"},OnKeyUp:function(e){if(!e)e=window.event;if(e.keyCode==27)this.ClosePopup()},ClosePopup:function(){for(var e in this.Popup){this.Popup[e].pWin.Get().style.display="none";this.Popup[e].bShowed=false;this.Popup[e].pWin.Close()}if(this.bCloseEventsAttached){this.bCloseEventsAttached=false;BX.unbind(document,"keyup",BX.proxy(this.OnKeyUp,this));BX.unbind(document,"click",BX.proxy(this.ClosePopup,this))}},CreatePopup:function(e){var t=this;this.Popup[e]={pWin:new BX.CWindow(false,"float")};if(e=="outlook")this.Popup[e].pSel=this.pOutlSel;else if(e=="mobile")this.Popup[e].pSel=this.pMobSel;BX.addClass(this.Popup[e].pWin.Get(),"bxec-ban-popup")},Close:function(e){this.pWnd.parentNode.removeChild(this.pWnd);if(e!==false){if(BX.admin&&BX.admin.panel)BX.admin.panel.Notify(EC_MESS.CloseBannerNotify);this.oEC.userSettings.showBanner=false;BX.userOptions.save("calendar","user_settings","showBanner",0)}},RunOutlook:function(id){var oSect=this.oEC.oSections[id];if(oSect&&oSect.OUTLOOK_JS&&oSect.OUTLOOK_JS.length>0)try{eval(oSect.OUTLOOK_JS)}catch(e){}},RunMobile:function(e){this.oEC.ShowMobileHelpDialog(e)}};var ECMonthSelector=function(e){this.oEC=e;this.Build();this.content={month:"",week:"",day:""}};ECMonthSelector.prototype={Build:function(){var e=this;this.pPrev=BX(this.oEC.id+"selector-prev");this.pNext=BX(this.oEC.id+"selector-next");this.pCont=BX(this.oEC.id+"selector-cont");this.pContInner=BX(this.oEC.id+"selector-cont-inner");this.pPrev.onclick=function(){e.ChangeValue(false)};this.pNext.onclick=function(){e.ChangeValue(true)}},ChangeMode:function(e){this.mode=e||this.oEC.activeTabId;if(this.mode=="month"){this.pCont.className="bxec-sel-but";this.pCont.onclick=BX.proxy(this.ShowMonthPopup,this)}else{this.pCont.className="bxec-sel-text";this.pCont.onclick=BX.False}},OnChange:function(e,t,i,s){t=parseInt(t,10);e=parseInt(e);var o,n;this.pNext.style.marginLeft=this.mode=="month"&&BX.browser.IsIE()&&!BX.browser.IsIE9()?"10px":"";if(this.mode=="month"){if(t<0||t>11)return alert("Error! Incorrect month");this.content.month=this.oEC.arConfig.month[t]+",&nbsp;"+e+'<span class="bxec-sel-but-arr">'}else if(this.mode=="week"){var a=new Date;a.setFullYear(e,t,1);n=this.oEC.GetWeekDayOffset(this.oEC.GetWeekDayByInd(a.getDay()));if(n>0)a.setDate(a.getDate()-n);if(i!=0)a.setDate(a.getDate()+7*i);var r=new Date(a.getTime());r.setDate(r.getDate()+6);var l,h=this.oEC.arConfig.month_r,c=a.getDate(),d=a.getMonth(),p=a.getFullYear(),u=r.getDate(),m=r.getMonth(),v=r.getFullYear();if(d==m)l=c+"&nbsp;-&nbsp;"+u+"&nbsp;"+h[d]+"&nbsp;"+p;else if(p==v)l=c+"&nbsp;"+h[d]+"&nbsp;-&nbsp;"+u+"&nbsp;"+h[m]+"&nbsp;"+p;else l=c+"&nbsp;"+h[d]+"&nbsp;"+p+"&nbsp;-&nbsp;"+u+"&nbsp;"+h[m]+"&nbsp;"+v;this.content.week="<nobr>"+l+"</nobr>";o={dateFrom:c,monthFrom:d,yearFrom:p,weekStartDate:a,monthTo:m,yearTo:v,dateTo:u,weekEndDate:r}}else if(this.mode=="day"){var f=new Date;f.setFullYear(e,t,s);day=this.oEC.ConvertDayIndex(f.getDay());s=f.getDate(),t=f.getMonth(),e=f.getFullYear();this.content.day="<nobr>"+this.oEC.arConfig.days[day][0]+",&nbsp;"+s+"&nbsp;"+this.oEC.arConfig.month_r[t]+"&nbsp;"+e+"</nobr>";o={date:s,month:t,year:e,oDate:f}}this.Show(this.mode);return o},Show:function(e){this.pContInner.innerHTML=this.content[e]},ChangeValue:function(e){var t=e?1:-1;if(this.mode=="month"){var i=bxInt(this.oEC.activeDate.month)+t;var s=this.oEC.activeDate.year;if(i<0){i+=12;s--}else if(i>11){i-=12;s++}this.oEC.SetMonth(i,s)}else if(this.mode=="week"){this.oEC.SetWeek(this.oEC.activeDate.week+t,this.oEC.activeDate.month,this.oEC.activeDate.year)}else if(this.mode=="day"){this.oEC.SetDay(this.oEC.activeDate.date+t,this.oEC.activeDate.month,this.oEC.activeDate.year)}},ShowMonthPopup:function(){if(!this.oMonthWin){var e=this;this.oMonthWin=new BX.PopupWindow(this.oEC.id+"bxc-month-sel",this.pCont,{overlay:{opacity:1},autoHide:true,offsetTop:1,offsetLeft:0,lightShadow:true,content:BX("bxec_month_win_"+this.oEC.id)});this.oMonthWin.CAL={DOM:{Year:BX(this.oEC.id+"md-year"),MonthList:BX(this.oEC.id+"md-month-list")},curYear:parseInt(this.oEC.activeDate.year)};this.oMonthWin.CAL.DOM.Year.innerHTML=this.oMonthWin.CAL.curYear;BX(this.oEC.id+"md-selector-prev").onclick=function(){e.oMonthWin.CAL.DOM.Year.innerHTML=--e.oMonthWin.CAL.curYear};BX(this.oEC.id+"md-selector-next").onclick=function(){e.oMonthWin.CAL.DOM.Year.innerHTML=++e.oMonthWin.CAL.curYear};var t,i,s,o=[0,4,8,1,5,9,2,6,10,3,7,11];for(t=0;t<12;t++){i=o[t];s=this.oMonthWin.CAL.DOM.MonthList.appendChild(BX.create("DIV",{props:{id:"bxec_ms_m_"+o[t],className:"bxec-month-div"+(o[t]==this.oEC.activeDate.month?" bxec-month-act":"")+" bxec-"+this.GetSeason(o[t])},html:"<span>"+this.oEC.arConfig.month[o[t]]+"</span>",events:{click:function(){BX.removeClass(e.oMonthWin.CAL.DOM.curMonth,"bxec-month-act");BX.addClass(this,"bxec-month-act");e.oMonthWin.CAL.DOM.curMonth=this;e.oEC.SetMonth(parseInt(this.id.substr("bxec_ms_m_".length)),e.oMonthWin.CAL.curYear);e.oMonthWin.close()}}}));if(o[t]==this.oEC.activeDate.month)this.oMonthWin.CAL.DOM.curMonth=s}}this.oMonthWin.show()},GetSeason:function(e){switch(e){case 11:case 0:case 1:return"winter";case 2:case 3:case 4:return"spring";case 5:case 6:case 7:return"summer";case 8:case 9:case 10:return"autumn"}}};var ECCalendarAccess=function(e){BX.Access.Init();if(!window.EC_MESS)EC_MESS={};this.bind=e.bind;this.GetAccessName=e.GetAccessName;this.pTbl=e.pCont.appendChild(BX.create("TABLE",{props:{className:"bxc-access-tbl"}}));this.pSel=BX("bxec-"+this.bind);var t=this;this.delTitle=e.delTitle||EC_MESS.Delete;this.noAccessRights=e.noAccessRights||EC_MESS.NoAccessRights;this.inputName=e.inputName||false;e.pLink.onclick=function(){BX.Access.ShowForm({callback:BX.proxy(t.InsertRights,t),bind:t.bind})}};ECCalendarAccess.prototype={InsertRights:function(e){var t,i;for(t in e)for(i in e[t])this.InsertAccessRow(BX.Access.GetProviderName(t)+" "+e[t][i].name,i)},InsertAccessRow:function(e,t,i){var s=this,o,n,a,r;if(this.pTbl.rows[0]&&this.pTbl.rows[0].cells[0]&&this.pTbl.rows[0].cells[0].className.indexOf("bxc-access-no-vals")!=-1)this.DeleteRow(0);o=this.pTbl.insertRow(-1);n=BX.adjust(o.insertCell(-1),{props:{className:"bxc-access-c-l"},html:e+":"});a=BX.adjust(o.insertCell(-1),{props:{className:"bxc-access-c-r"}});r=a.appendChild(this.pSel.cloneNode(true));r.id="BXEC_ACCESS_"+t;if(i)r.value=i;pDel=a.appendChild(BX.create("A",{props:{className:"access-delete",href:"javascript:void(0)",title:this.delTitle},events:{click:function(){s.DeleteRow(this.parentNode.parentNode.rowIndex)}}}));if(this.inputName){r.name=this.inputName+"["+t+"]"}},DeleteRow:function(e){if(this.pTbl.rows[e])this.pTbl.deleteRow(e)},GetValues:function(){var e,t,i={},s=this.pTbl.getElementsByTagName("SELECT"),o,n=s.length;for(o=0;o<n;o++){e=s[o].id.substr("BXEC_ACCESS_".length);t=s[o].value;i[e]=t}return i},SetSelected:function(e){if(!e)e={};while(this.pTbl.rows[0])this.pTbl.deleteRow(0);var t,i={};for(t in e){this.InsertAccessRow(this.GetTitleByCode(t),t,e[t]);i[t]=true}if(this.pTbl.rows.length<=0)BX.adjust(this.pTbl.insertRow(-1).insertCell(-1),{props:{className:"bxc-access-no-vals",colSpan:2},html:"<span>"+this.noAccessRights+"</span>"});BX.Access.SetSelected(i,this.bind)},GetTitleByCode:function(e){return this.GetAccessName(e)}};function ECColorPicker(e){this.bOpened=false;this.zIndex=5e3;this.id="";this.Popups={};this.Conts={}}ECColorPicker.prototype={Create:function(){var e=this;var t=document.body.appendChild(BX.create("DIV",{props:{className:"ec-colpick-cont"},style:{zIndex:this.zIndex}}));var i=["#FF0000","#FFFF00","#00FF00","#00FFFF","#0000FF","#FF00FF","#FFFFFF","#EBEBEB","#E1E1E1","#D7D7D7","#CCCCCC","#C2C2C2","#B7B7B7","#ACACAC","#A0A0A0","#959595","#EE1D24","#FFF100","#00A650","#00AEEF","#2F3192","#ED008C","#898989","#7D7D7D","#707070","#626262","#555","#464646","#363636","#262626","#111","#000000","#F7977A","#FBAD82","#FDC68C","#FFF799","#C6DF9C","#A4D49D","#81CA9D","#7BCDC9","#6CCFF7","#7CA6D8","#8293CA","#8881BE","#A286BD","#BC8CBF","#F49BC1","#F5999D","#F16C4D","#F68E54","#FBAF5A","#FFF467","#ACD372","#7DC473","#39B778","#16BCB4","#00BFF3","#438CCB","#5573B7","#5E5CA7","#855FA8","#A763A9","#EF6EA8","#F16D7E","#EE1D24","#F16522","#F7941D","#FFF100","#8FC63D","#37B44A","#00A650","#00A99E","#00AEEF","#0072BC","#0054A5","#2F3192","#652C91","#91278F","#ED008C","#EE105A","#9D0A0F","#A1410D","#A36209","#ABA000","#588528","#197B30","#007236","#00736A","#0076A4","#004A80","#003370","#1D1363","#450E61","#62055F","#9E005C","#9D0039","#790000","#7B3000","#7C4900","#827A00","#3E6617","#045F20","#005824","#005951","#005B7E","#003562","#002056","#0C004B","#30004A","#4B0048","#7A0045","#7A0026"],s,o,n,a=BX.create("TABLE",{props:{className:"ec-colpic-tbl"}}),r,l=i.length;s=a.insertRow(-1);o=s.insertCell(-1);o.colSpan=8;var h=o.appendChild(BX.create("SPAN",{props:{className:"ec-colpic-def-but"},text:EC_MESS.DefaultColor}));h.onmouseover=function(){this.className="ec-colpic-def-but ec-colpic-def-but-over";n.style.backgroundColor="#FF0000"};h.onmouseout=function(){this.className="ec-colpic-def-but"};h.onmousedown=function(t){e.Select("#FF0000")};n=s.insertCell(-1);n.colSpan=8;n.className="ec-color-inp-cell";n.style.backgroundColor=i[38];for(r=0;r<l;r++){if(Math.round(r/16)==r/16)s=a.insertRow(-1);o=s.insertCell(-1);o.innerHTML="&nbsp;";o.className="ec-col-cell";o.style.backgroundColor=i[r];o.id="lhe_color_id__"+r;o.onmouseover=function(e){this.className="ec-col-cell ec-col-cell-over";n.style.backgroundColor=i[this.id.substring("lhe_color_id__".length)]};o.onmouseout=function(e){this.className="ec-col-cell"};o.onmousedown=function(t){var s=this.id.substring("lhe_color_id__".length);e.Select(i[s])}}t.appendChild(a);this.Conts[this.id]=t},Open:function(e){this.id=e.id+Math.round(Math.random()*1e6);this.key=e.key;this.OnSelect=e.onSelect;if(!this.Conts[this.id])this.Create();if(!this.Popups[this.id]){this.Popups[this.id]=BX.PopupWindowManager.create("bxc-color-popup"+this.id,e.pWnd,{autoHide:true,offsetTop:1,offsetLeft:0,lightShadow:true,content:this.Conts[this.id]})}this.Popups[this.id].show()},Close:function(){this.Popups[this.id].close();this.Popups[this.id].destroy()},OnKeyPress:function(e){if(!e)e=window.event;if(e.keyCode==27)this.Close()},Select:function(e){if(this.OnSelect&&typeof this.OnSelect=="function")this.OnSelect(e);this.Close()}};window.BxEditEventGridSetLinkName=function(e){var t=BX("event-grid-dest-add-link");if(t)t.innerHTML=BX.SocNetLogDestination.getSelectedCount(e)>0?BX.message("BX_FPD_LINK_2"):BX.message("BX_FPD_LINK_1")};window.BxEditEventGridSelectCallback=function(e,t,i){var s=t;prefix="S";if(t=="sonetgroups")prefix="SG";else if(t=="groups"){prefix="UA";s="all-users"}else if(t=="users")prefix="U";else if(t=="department")prefix="DR";BX("event-grid-dest-item").appendChild(BX.create("span",{attrs:{"data-id":e.id},props:{className:"event-grid-dest event-grid-dest-"+s},children:[BX.create("input",{attrs:{type:"hidden",name:"EVENT_DESTINATION["+prefix+"][]",value:e.id}}),BX.create("span",{props:{className:"event-grid-dest-text"},html:e.name}),BX.create("span",{props:{className:"feed-event-del-but"},attrs:{"data-item-id":e.id,"data-item-type":t}})]}));BX.onCustomEvent("OnDestinationAddNewItem",[e]);BX("event-grid-dest-input").value="";BxEditEventGridSetLinkName(editEventDestinationFormName)};window.BxEditEventGridUnSelectCallback=function(e,t,i){var s=BX.findChildren(BX("event-grid-dest-item"),{attribute:{"data-id":""+e.id+""}},true);if(s!=null){for(var o=0;o<s.length;o++)BX.remove(s[o])}BX.onCustomEvent("OnDestinationUnselect");BX("event-grid-dest-input").value="";BxEditEventGridSetLinkName(editEventDestinationFormName)};window.BxEditEventGridOpenDialogCallback=function(){BX.style(BX("event-grid-dest-input-box"),"display","inline-block");BX.style(BX("event-grid-dest-add-link"),"display","none");BX.focus(BX("event-grid-dest-input"))};window.BxEditEventGridCloseDialogCallback=function(){if(!BX.SocNetLogDestination.isOpenSearch()&&BX("event-grid-dest-input").value.length<=0){BX.style(BX("event-grid-dest-input-box"),"display","none");BX.style(BX("event-grid-dest-add-link"),"display","inline-block");BxEditEventGridDisableBackspace()}};window.BxEditEventGridCloseSearchCallback=function(){if(!BX.SocNetLogDestination.isOpenSearch()&&BX("event-grid-dest-input").value.length>0){BX.style(BX("event-grid-dest-input-box"),"display","none");BX.style(BX("event-grid-dest-add-link"),"display","inline-block");BX("event-grid-dest-input").value="";BxEditEventGridDisableBackspace()}};window.BxEditEventGridDisableBackspace=function(e){if(BX.SocNetLogDestination.backspaceDisable||BX.SocNetLogDestination.backspaceDisable!=null)BX.unbind(window,"keydown",BX.SocNetLogDestination.backspaceDisable);BX.bind(window,"keydown",BX.SocNetLogDestination.backspaceDisable=function(e){if(e.keyCode==8){BX.PreventDefault(e);return false}});setTimeout(function(){BX.unbind(window,"keydown",BX.SocNetLogDestination.backspaceDisable);BX.SocNetLogDestination.backspaceDisable=null},5e3)};window.BxEditEventGridSearchBefore=function(e){return BX.SocNetLogDestination.searchBeforeHandler(e,{formName:editEventDestinationFormName,inputId:"event-grid-dest-input"})};window.BxEditEventGridSearch=function(e){return BX.SocNetLogDestination.searchHandler(e,{formName:editEventDestinationFormName,inputId:"event-grid-dest-input",linkId:"event-grid-dest-add-link",sendAjax:true})};(function(e){e.EditEventPopupController=function(e){this.config=e;this.id=this.config.id;this.oEC=this.config.oEC;this.oEvent=this.config.oEvent;this.Form=this.config.form;this.Init()};e.EditEventPopupController.prototype={Init:function(){this.InitDateTimeControls();var t=this,i=this.oEC.id+"_event_editor",s=e["BXHtmlEditor"].Get(i);if(s&&s.IsShown()){this.CustomizeHtmlEditor(s)}else{BX.addCustomEvent(e["BXHtmlEditor"],"OnEditorCreated",function(e){if(e.id==i){t.CustomizeHtmlEditor(e)}})}if(this.oEC.allowMeetings)this.InitDestinationControls();this.FillFormFields()},SaveForm:function(e){var t,i,s=this,o=parseInt(this.oEC.activeDate.month,10),n=this.oEC.activeDate.year,a=this.oEC.actionUrl,r=Math.round(Math.random()*1e6);a+=a.indexOf("?")==-1?"?":"&";a+="action=edit_event&bx_event_calendar_request=Y&sessid="+BX.bitrix_sessid()+"&reqId="+r;this.Form.action=a;if(BX.util.trim(this.pFromTime.value)!=""||BX.util.trim(this.pFromDate.value)!=""){t=this.oEC.ParseDate(BX.util.trim(this.pFromDate.value)+(this.pFullDay.checked?"":" "+BX.util.trim(this.pFromTime.value)))}if(BX.util.trim(this.pToTime.value)!=""||BX.util.trim(this.pToDate.value)!=""){i=this.oEC.ParseDate(BX.util.trim(this.pToDate.value)+(this.pFullDay.checked?"":" "+BX.util.trim(this.pToTime.value)))}BX("event-location-old"+this.id).value=this.Loc.OLD||false;BX("event-location-new"+this.id).value=this.Loc.NEW;if(this.Loc.NEW.substr(0,5)=="ECMR_"&&this.RepeatCheck.checked){alert(EC_MESS.reservePeriodWarn);return false}if(this.Loc.NEW.substr(0,5)=="ECMR_"&&!e.bLocationChecked){if(i&&this.pFullDay.checked){i=new Date(i.getTime()+864e5)}if(t&&i){this.oEC.CheckMeetingRoom({id:this.oEvent.ID||0,from:s.oEC.FormatDateTime(t),to:s.oEC.FormatDateTime(i),location_new:this.Loc.NEW,location_old:this.Loc.OLD||false},function(t){if(!t)return alert(EC_MESS.MRReserveErr);if(t=="reserved")return alert(EC_MESS.MRNotReservedErr);e.bLocationChecked=true;s.SaveForm(e)});return false}}if(t&&BX.util.trim(this.pFromTime.value)!="")this.pFromTime.value=this.oEC.FormatTime(t,true);if(i&&BX.util.trim(this.pToTime.value)!="")this.pToTime.value=this.oEC.FormatTime(i,true);BX("event-id"+this.id).value=this.oEvent.ID||0;BX("event-month"+this.id).value=o+1;BX("event-year"+this.id).value=n;if(this.RepeatCheck.checked){var l=this.RepeatSelect.value;if(this.RepeatDiapTo.value==EC_MESS.NoLimits)this.RepeatDiapTo.value="";if(l=="WEEKLY"){var h=[],c;for(c=0;c<7;c++)if(this.RepeatWeekDaysCh[c].checked)h.push(this.RepeatWeekDaysCh[c].value);if(h.length==0)this.RepeatSelect.value="NONE";else BX("event-rrule-byday"+this.id).value=h.join(",")}}BX.ajax.submit(this.Form,function(e){var t=top.BXCRES[r];if(top.BXCRES[r]){s.oEC.Event.UnDisplay(t.id,false);s.oEC.HandleEvents(t.events,t.attendees);s.oEC.arLoadedMonth[o+"."+n]=true;if(t.deletedEventId>0)s.oEC.Event.UnDisplay(t.deletedEventId,false);s.oEC.Event.Display()}});var d=this.pSectSelect.value,p=s.oEC.oSections&&s.oEC.oSections[d]?s.oEC.oSections[d]:{},u=this.TextColor,m=this.Color;if(!p.COLOR||p.COLOR&&p.COLOR.toLowerCase()!=m.toLowerCase())BX(this.id+"_bxec_color").value=m;if(!p.TEXT_COLOR||p.TEXT_COLOR&&p.TEXT_COLOR.toLowerCase()!=u.toLowerCase())BX(this.id+"_bxec_text_color").value=u;if(!this.oEC.arConfig.userTimezoneName){this.config.userTimezoneName=this.oEC.arConfig.userTimezoneName=this.pDefTimezone.value}if(e.callback)e.callback()},InitDestinationControls:function(){var e=this;BX.addCustomEvent("OnDestinationAddNewItem",BX.proxy(this.DestinationOnChange,this));BX.addCustomEvent("OnDestinationUnselect",BX.proxy(this.DestinationOnChange,this));this.pAttCont=BX("event-grid-att"+this.id);this.pMeetingParams=BX("event-grid-meeting-params"+this.id);this.pDestValuesCont=BX("event-grid-dest-item");BX.bind(this.pDestValuesCont,"click",function(e){var t=e.target||e.srcElement;if(t.className=="feed-event-del-but"){BX.SocNetLogDestination.deleteItem(t.getAttribute("data-item-id"),t.getAttribute("data-item-type"),editEventDestinationFormName);BX.PreventDefault(e)}});BX.bind(this.pDestValuesCont,"mouseover",function(e){var t=e.target||e.srcElement;if(t.className=="feed-event-del-but")BX.addClass(t.parentNode,"event-grid-dest-hover")});BX.bind(this.pDestValuesCont,"mouseout",function(e){var t=e.target||e.srcElement;if(t.className=="feed-event-del-but")BX.removeClass(t.parentNode,"event-grid-dest-hover")});this.pAttContY=BX("event-edit-att-y");this.pAttContN=BX("event-edit-att-n");this.pAttContQ=BX("event-edit-att-q");this.attendeeIndex={};if(this.oEvent.IS_MEETING){BX.addClass(this.pAttCont,"event-grid-dest-cont-full");this.pMeetingParams.style.display="block";this.DisplayAttendees(this.oEvent["~ATTENDEES"])}this.AddMeetTextLink=BX(this.id+"_add_meet_text");this.HideMeetTextLink=BX(this.id+"_hide_meet_text");this.MeetTextCont=BX(this.id+"_meet_text_cont");this.MeetText=BX(this.id+"_meeting_text");this.OpenMeeting=BX(this.id+"_ed_open_meeting");this.NotifyStatus=BX(this.id+"_ed_notify_status");this.Reinvite=BX(this.id+"_ed_reivite");this.ReinviteCont=BX(this.id+"_ed_reivite_cont");this.AddMeetTextLink.onclick=function(){this.parentNode.style.display="none";e.MeetTextCont.style.display="block";BX.focus(e.MeetText)};this.HideMeetTextLink.onclick=function(){e.AddMeetTextLink.parentNode.style.display="block";e.MeetTextCont.style.display="none"};if(this.oEvent.IS_MEETING){this.OpenMeeting.checked=!!(this.oEvent.MEETING&&this.oEvent.MEETING.OPEN);this.NotifyStatus.checked=!!(this.oEvent.MEETING&&this.oEvent.MEETING.NOTIFY);if(this.oEvent.MEETING){this.MeetText.value=this.oEvent.MEETING.TEXT||"";if(this.oEvent.MEETING.TEXT!="")this.AddMeetTextLink.onclick()}else{this.MeetText.value=""}this.Reinvite.checked=this.oEvent.MEETING.REINVITE===true}else{this.AddMeetTextLink.parentNode.style.display="block";this.MeetTextCont.style.display="none";if(this.oEvent.MeetText)this.oEvent.MeetText.value="";if(this.oEvent.HideMeetTextLink)this.oEvent.HideMeetTextLink.onclick()}BX(this.id+"_planner_link").onclick=function(){var t=[];if(t.length==0)t.push({id:e.oEC.userId,name:e.oEC.userName});var i=e.Loc.NEW,s=e.oEC.ParseLocation(i,true),o=s.mrind==undefined?false:s.mrind;e.oEC.RunPlanner({curEventId:e.oEvent.ID||false,attendees:t,fromDate:e.pFromDate.value,toDate:e.pToDate.value,fromTime:e.pFromTime.value,toTime:e.pToTime.value,fromTz:e.pFromTz.value,toTz:e.pToTz.value,defaultTz:e.pDefTimezone.value,location:e.Loc.NEW,locationMrind:o,oldLocationMRId:e.Loc.OLD_mrevid})}},DestroyDestinationControls:function(){BX.removeCustomEvent("OnDestinationAddNewItem",BX.proxy(this.DestinationOnChange,this));BX.removeCustomEvent("OnDestinationUnselect",BX.proxy(this.DestinationOnChange,this))},DestinationOnChange:function(){var e=this,t={},i,s,o=this.pDestValuesCont.getElementsByTagName("INPUT"),n,a=[];for(n=0;n<o.length;n++){a.push(o[n].value)}t.eventId=this.oEvent.ID||false;t.dateFrom=this.pFromDate.value;t.dateTo=this.pToDate.value;var r=this.ParseDateFromTo();this.oEC.GetAttendeesByCodes(a,function(t,i){if(t.length>0){BX.addClass(e.pAttCont,"event-grid-dest-cont-full");e.pMeetingParams.style.display="block"}else{BX.removeClass(e.pAttCont,"event-grid-dest-cont-full");e.pMeetingParams.style.display="none"}i=e.oEC.HandleAccessibility(i);i=e.oEC.FilterAccessibility(i,r.from,r.to);e.DisplayAttendees(t,i)},t)},DisplayAttendees:function(e,t){BX.cleanNode(this.pAttContY);BX.cleanNode(this.pAttContN);BX.cleanNode(this.pAttContQ);this.pAttContY.style.display=this.pAttContN.style.display=this.pAttContQ.style.display="none";var i={Y:false,N:false,Q:false};for(var s in e){if(this.attendeeIndex[e[s].USER_ID])e[s].STATUS=this.attendeeIndex[e[s].USER_ID]||"Q";else e[s].STATUS=this.attendeeIndex[e[s].USER_ID]=e[s].STATUS||"Q";if(e[s].STATUS=="Q"){this.AddAttendee(e[s],this.pAttContQ);if(!i.Q)i.Q=!(this.pAttContQ.style.display="")}else if(e[s].STATUS=="Y"){this.AddAttendee(e[s],this.pAttContY);if(!i.Y)i.Y=!(this.pAttContY.style.display="");

}else{this.AddAttendee(e[s],this.pAttContN);if(!i.N)i.N=!(this.pAttContN.style.display="")}}},AddAttendee:function(e,t){var i=t.appendChild(BX.create("DIV",{props:{},children:[BX.create("A",{props:{href:e.URL,title:e.DISPLAY_NAME,className:"bxcal-user bxcal-user-link-name",target:"_blank"},html:'<span class="bxcal-user-status"></span><span class="bxcal-user-avatar-outer"><span class="bxcal-user-avatar"><img src="'+e.AVATAR+'" width="21" height="21" /></span></span><span class="bxcal-user-name">'+BX.util.htmlspecialchars(e.DISPLAY_NAME)+"</span>"})]}));if(e.ACC=="busy"||e.ACC=="absent")i.appendChild(BX.create("SPAN",{props:{className:"bxcal-user-acc"},text:"("+EC_MESS["acc_status_"+e.ACC]+")"}))},InitDateTimeControls:function(){this.pFromToCont=BX("feed-cal-from-to-cont"+this.id);this.pFromDate=BX("feed-cal-event-from"+this.id);this.pToDate=BX("feed-cal-event-to"+this.id);this.pFromTime=BX("feed_cal_event_from_time"+this.id);this.pToTime=BX("feed_cal_event_to_time"+this.id);this.pFullDay=BX("event-full-day"+this.id);this.pDefTimezone=BX("event-tz-def"+this.id);this.pDefTimezoneWrap=BX("event-tz-def-wrap"+this.id);this.pDefTimezone.onchange=BX.proxy(this.DefaultTimezoneOnChange,this);this.pFromTz=BX("event-tz-from"+this.id);this.pToTz=BX("event-tz-to"+this.id);this.pTzOuterCont=BX("event-tz-cont-outer"+this.id);this.pTzSwitch=BX("event-tz-switch"+this.id);this.pTzCont=BX("event-tz-cont"+this.id);this.pTzInnerCont=BX("event-tz-inner-cont"+this.id);this.pTzSwitch.onclick=BX.proxy(this.TimezoneSwitch,this);this.pFromTz.onchange=BX.proxy(this.TimezoneFromOnChange,this);this.pToTz.onchange=BX.proxy(this.TimezoneToOnChange,this);new BX.CHint({parent:BX("event-tz-tip"+this.id),hint:EC_MESS.eventTzHint});new BX.CHint({parent:BX("event-tz-def-tip"+this.id),hint:EC_MESS.eventTzDefHint});this.pReminderCont=BX("feed-cal-reminder-cont"+this.id);this.pReminder=BX("event-reminder"+this.id);this.pRemType=BX("event_remind_type"+this.id);this.pRemCount=BX("event_remind_count"+this.id);this.pFullDay.onclick=BX.proxy(this.FullDay,this);this.pReminder.onclick=BX.proxy(this.Reminder,this);var t=this;this.pFromDate.onclick=function(){BX.calendar({node:this.parentNode,field:this,bTime:false})};this.pToDate.onclick=function(){BX.calendar({node:this.parentNode,field:this,bTime:false})};this.pFromDate.onchange=function(){if(t._FromDateValue){var e=BX.parseDate(t._FromDateValue),i=BX.parseDate(t.pFromDate.value),s=BX.parseDate(t.pToDate.value);if(i&&e){var o=s.getTime()-e.getTime();if(o<0)o=0;s=new Date(i.getTime()+o);if(s)t.pToDate.value=bxFormatDate(s.getDate(),s.getMonth()+1,s.getFullYear())}}t._FromDateValue=t.pFromDate.value;t.UpdateAccessibility()};this.pFromTime.parentNode.onclick=this.pFromTime.onclick=e["bxShowClock_"+"feed_cal_event_from_time"+t.id];this.pToTime.parentNode.onclick=this.pToTime.onclick=e["bxShowClock_"+"feed_cal_event_to_time"+t.id];this.pFromTime.onchange=function(){var e=t.oEC.ParseDate(BX.util.trim(t.pFromDate.value)+" "+BX.util.trim(t.pFromTime.value));if(t.pToDate.value=="")t.pToDate.value=t.pFromDate.value;var i=t.oEC.ParseDate(BX.util.trim(t.pToDate.value)+" "+BX.util.trim(t.pToTime.value));if(t._FromTimeValue){var s=t.oEC.ParseDate(BX.util.trim(t.pFromDate.value)+" "+t._FromTimeValue);var o=i.getTime()-s.getTime();if(o<0)o=36e5;var n=new Date(e.getTime()+o);t.pToDate.value=t.oEC.FormatDate(n);t.pToTime.value=t.oEC.FormatTime(n)}t._FromTimeValue=t.pFromTime.value;t.UpdateAccessibility()};this.pToDate.onchange=this.pToTime.onchange=function(){t.UpdateAccessibility()};var i,s;if(this.oEvent.ID){this.pFullDay.checked=this.bFullDay=this.oEvent.DT_SKIP_TIME=="Y";this.pFullDay.onclick();i=BX.parseDate(this.oEvent["~DATE_FROM"]||this.oEvent.DATE_FROM);s=BX.parseDate(this.oEvent["~DATE_TO"]||this.oEvent.DATE_TO);this.pFromDate.value=this.oEC.FormatDate(i);this.pToDate.value=this.oEC.FormatDate(s);if(this.oEvent.DT_SKIP_TIME!=="Y"){this.pFromTime.value=this.oEC.FormatTime(i);this.pToTime.value=this.oEC.FormatTime(s);this.pFromTz.value=this.oEvent.TZ_FROM||"";this.pToTz.value=this.oEvent.TZ_TO||"";if(this.oEvent.TZ_TO!==this.oEvent.TZ_FROM||this.oEvent.TZ_TO!==this.config.userTimezoneName||parseInt(this.oEvent["~USER_OFFSET_FROM"])>0||parseInt(this.oEvent["~USER_OFFSET_TO"])>0){this.pTzCont.style.height=this.pTzInnerCont.offsetHeight+"px";BX.addClass(this.pTzOuterCont,"bxec-timezone-outer-wrap-opened")}}if(this.oEvent.REMIND&&this.oEvent.REMIND.length>0){this.pReminder.checked=true;this.pRemType.value=this.oEvent.REMIND[0].type;this.pRemCount.value=this.oEvent.REMIND[0].count;this.Reminder(false,true)}else{this.pReminder.checked=false;this.pRemType.value="min";this.pRemCount.value="15";this.Reminder(false,false)}if(this.config.userTimezoneName){this.pDefTimezoneWrap.style.display="none"}else{this.pDefTimezoneWrap.style.display="";this.pDefTimezone.value=this.config.userTimezoneDefault||""}}else{i=this.oEC.GetUsableDateTime((new Date).getTime(),15);s=this.oEC.GetUsableDateTime(i.getTime()+36e5,15);this.pFromDate.value=this.oEC.FormatDate(i);this.pFromTime.value=this.oEC.FormatTime(i);this.pToDate.value=this.oEC.FormatDate(s);this.pToTime.value=this.oEC.FormatTime(s);if(this.config.userTimezoneName){this.pDefTimezoneWrap.style.display="none";this.pDefTimezone.value=this.config.userTimezoneName;this.pFromTz.value=this.pToTz.value=this.config.userTimezoneName}else{this.pDefTimezoneWrap.style.display="";this.pFromTz.value=this.pToTz.value=this.pDefTimezone.value=this.config.userTimezoneDefault||""}this.pFullDay.checked=false;this.FullDay(false,true);this.pReminder.checked=true;this.pRemType.value="min";this.pRemCount.value="15";this.Reminder(false,true)}this.linkFromToTz=this.pFromTz.value==this.pToTz.value;this.linkFromToDefaultTz=this.pFromTz.value==this.pToTz.value&&this.pFromTz.value==this.pDefTimezone.value;this._FromTimeValue=this.pFromTime.value;this._FromDateValue=this.pFromDate.value},FillFormFields:function(){var e=this;this.pName=BX(this.id+"_edit_ed_name");this.pName.value=this.oEvent.NAME||"";this.Title=this.config.Title;this.pName.onkeydown=this.pName.onchange=function(){if(this._titleTimeout)clearTimeout(this._titleTimeout);this._titleTimeout=setTimeout(function(){var t=BX.util.htmlspecialchars(e.pName.value);e.Title.innerHTML=(e.oEvent.ID?EC_MESS.EditEvent:EC_MESS.NewEvent)+(t!=""?": "+t:"")},20)};this.Location=new BXInputPopup({id:this.id+"loc_1",values:this.oEC.bUseMR?this.oEC.meetingRooms:false,input:BX(this.id+"_planner_location1"),defaultValue:EC_MESS.SelectMR,openTitle:EC_MESS.OpenMRPage,className:"calendar-inp calendar-inp-time",noMRclassName:"calendar-inp calendar-inp-time"});this.Loc={};BX.addCustomEvent(this.Location,"onInputPopupChanged",BX.proxy(this.LocationOnChange,this));if(this.oEvent.ID){var t=BX.util.htmlspecialcharsback(this.oEvent.LOCATION);this.Loc.OLD=t;this.Loc.NEW=t;var i=this.oEC.ParseLocation(t,true);if(i.mrid&&i.mrevid){this.Location.Set(i.mrind,"");this.Loc.OLD_mrid=i.mrid;this.Loc.OLD_mrevid=i.mrevid}else{this.Location.Set(false,t)}}else{this.Location.Set(false,"")}this.pAccessibility=BX(this.id+"_bxec_accessibility");if(this.pAccessibility)this.pAccessibility.value=this.oEvent.ACCESSIBILITY||"busy";this.pPrivate=BX(this.id+"_bxec_private");if(this.pPrivate)this.pPrivate.checked=this.oEvent.PRIVATE_EVENT||false;this.pImportance=BX(this.id+"_bxec_importance");if(this.pImportance)this.pImportance.value=this.oEvent.IMPORTANCE||"normal";this.pSectSelect=BX(this.id+"_edit_ed_calend_sel");var s=this.oEvent.SECT_ID||this.oEC.GetLastSection();if(!this.oEC.oSections[s]){s=this.oEC.arSections[0].ID;this.oEC.SaveLastSection(s)}this.oEC.BuildSectionSelect(this.pSectSelect,s);this.pSectSelect.onchange=function(){var t=this.value;if(e.oEC.oSections[t]){e.oEC.SaveLastSection(t);e.ColorControl.Set(e.oEC.oSections[t].COLOR,e.oEC.oSections[t].TEXT_COLOR)}};this.RepeatCheck=BX(this.id+"_edit_ed_rep_check");this.RepeatSelect=BX(this.id+"_edit_ed_rep_sel");this.RepeatCont=BX(this.id+"_edit_ed_rep_cont");this.RepeatPhrase1=BX(this.id+"_edit_ed_rep_phrase1");this.RepeatPhrase2=BX(this.id+"_edit_ed_rep_phrase2");this.RepeatWeekDays=BX(this.id+"_edit_ed_rep_week_days");this.RepeatCount=BX(this.id+"_edit_ed_rep_count");this.RepeatDiapTo=BX(this.id+"edit-ev-rep-diap-to");this.RepeatSelect.onchange=function(){e.RepeatSelectOnChange(this.value)};this.RepeatCount.onmousedown=function(){e.bEditEventDialogOver=true};this.RepeatCheck.onclick=function(){if(this.checked)BX.addClass(e.RepeatCont,"bxec-popup-row-repeat-show");else BX.removeClass(e.RepeatCont,"bxec-popup-row-repeat-show")};this.RepeatDiapTo.onblur=this.RepeatDiapTo.onchange=function(){if(this.value&&this.value!=EC_MESS.NoLimits){this.style.color="#000000";return}this.value=EC_MESS.NoLimits;this.style.color="#C0C0C0"};this.RepeatDiapTo.onclick=function(){BX.calendar({node:this,field:this,bTime:false});BX.focus(this)};this.RepeatDiapTo.onfocus=function(){if(!this.value||this.value==EC_MESS.NoLimits)this.value="";this.style.color="#000000"};if(this.oEC.Event.IsRecursive(this.oEvent)){this.RepeatCheck.checked=true;this.RepeatSelect.value=this.oEvent.RRULE.FREQ}else{this.RepeatCheck.checked=false}this.RepeatCheck.onclick();this.RepeatSelect.onchange();this.ColorControl=this.oEC.InitColorDialogControl("event",function(t,i){e.Color=t;e.TextColor=i});if(!this.oEvent.displayColor&&this.oEC.oSections[s])this.oEvent.displayColor=this.oEC.oSections[s].COLOR;if(!this.oEvent.displayTextColor&&this.oEC.oSections[s])this.oEvent.displayTextColor=this.oEC.oSections[s].TEXT_COLOR;if(this.oEvent.displayColor)this.ColorControl.Set(this.oEvent.displayColor,this.oEvent.displayTextColor);else if(this.oEC.oSections[s])this.ColorControl.Set(this.oEC.oSections[s].COLOR,this.oEC.oSections[s].TEXT_COLOR)},LocationOnChange:function(e,t,i){var s=this.oEditEventDialog;if(t===false){this.Loc.NEW=i||""}else{this.Loc.NEW="ECMR_"+this.oEC.meetingRooms[t].ID}},RepeatSelectOnChange:function(e){var t,i,s;e=e.toUpperCase();if(e=="NONE"){}else{this.RepeatPhrase2.innerHTML=EC_MESS.DeDot;if(e=="WEEKLY"){this.RepeatPhrase1.innerHTML=EC_MESS.EveryF;this.RepeatPhrase2.innerHTML+=EC_MESS.WeekP;this.RepeatWeekDays.style.display=e=="WEEKLY"?"inline-block":"none";i={};if(!this.RepeatWeekDaysCh){this.RepeatWeekDaysCh=[];for(t=0;t<7;t++)this.RepeatWeekDaysCh[t]=BX(this.id+"bxec_week_day_"+t)}if(this.oEvent&&this.oEvent.ID&&this.oEvent.RRULE&&this.oEvent.RRULE.BYDAY){i=this.oEvent.RRULE.BYDAY}else{s=BX.parseDate(this.pFromDate.value);if(!s)s=bxGetDateFromTS(this.oEvent.DT_FROM_TS);if(s)i[this.oEC.GetWeekDayByInd(s.getDay())]=true}for(t=0;t<7;t++)this.RepeatWeekDaysCh[t].checked=!!i[this.RepeatWeekDaysCh[t].value]}else{if(e=="YEARLY")this.RepeatPhrase1.innerHTML=EC_MESS.EveryN;else this.RepeatPhrase1.innerHTML=EC_MESS.EveryM;if(e=="DAILY")this.RepeatPhrase2.innerHTML+=EC_MESS.DayP;else if(e=="MONTHLY")this.RepeatPhrase2.innerHTML+=EC_MESS.MonthP;else if(e=="YEARLY")this.RepeatPhrase2.innerHTML+=EC_MESS.YearP;this.RepeatWeekDays.style.display="none"}var o=this.oEvent&&this.oEC.Event.IsRecursive(this.oEvent);this.RepeatCount.value=!this.oEvent.ID||!o?1:this.oEvent.RRULE.INTERVAL;if(!this.oEvent.ID||!o){this.RepeatDiapTo.value=""}else{this.RepeatDiapTo.value=this.oEvent.RRULE["~UNTIL"]||""}this.RepeatDiapTo.onchange()}},CustomizeHtmlEditor:function(e){if(e.toolbar.controls&&e.toolbar.controls.spoiler){BX.remove(e.toolbar.controls.spoiler.pCont)}},FullDay:function(e,t){if(t==undefined)t=!this.bFullDay;if(t&&this.pFromDate.value!==""&&this.pFromTime.value===""&&this.pToDate.value!==""&&this.pToTime.value===""){var i=BX.parseDate(this.pFromDate.value),s=BX.parseDate(this.pToDate.value),o=i.getTime()===s.getTime();if(i){i.setHours(12);i.setMinutes(0);this.pFromTime.value=this.oEC.FormatTime(i)}if(s){s.setHours(o?13:12);s.setMinutes(0);this.pToTime.value=this.oEC.FormatTime(s)}this.UpdateAccessibility()}if(t&&this.config.userTimezoneName&&(this.pFromTz.value==""||this.pToTz.value=="")){this.pFromTz.value=this.pToTz.value=this.pDefTimezone.value=this.config.userTimezoneName}if(t){BX.removeClass(this.pFromToCont,"feed-cal-full-day")}else{BX.addClass(this.pFromToCont,"feed-cal-full-day")}this.bFullDay=t},Reminder:function(e,t){if(t==undefined)t=!this.bReminder;this.pReminderCont.className=t?"bxec-reminder":"bxec-reminder-collapsed";this.bReminder=t},TimezoneSwitch:function(){if(this.pTzCont.offsetHeight>0){this.pTzCont.style.height=0;BX.removeClass(this.pTzOuterCont,"bxec-timezone-outer-wrap-opened")}else{this.pTzCont.style.height=this.pTzInnerCont.offsetHeight+"px";BX.addClass(this.pTzOuterCont,"bxec-timezone-outer-wrap-opened")}},DefaultTimezoneOnChange:function(){var e=this.pDefTimezone.value;BX.userOptions.save("calendar","timezone_name","timezone_name",e);if(this.linkFromToDefaultTz)this.pToTz.value=this.pFromTz.value=this.pDefTimezone.value},TimezoneFromOnChange:function(){if(this.linkFromToTz)this.pToTz.value=this.pFromTz.value;this.linkFromToDefaultTz=false},TimezoneToOnChange:function(){this.linkFromToTz=false;this.linkFromToDefaultTz=false},UpdateAccessibility:function(e){var t=this;if(e!==false){if(this.updateAccessibilityTimeout)this.updateAccessibilityTimeout=clearTimeout(this.updateAccessibilityTimeout);this.updateAccessibilityTimeout=setTimeout(function(){t.UpdateAccessibility(false)},500);return}},ParseDateFromTo:function(){var e=this.pFromDate.value,t=this.pToDate.value;if(!this.pFullDay.checked){e+=" "+this.pFromTime.value;t+=" "+this.pToTime.value}return{from:this.oEC.ParseDate(e),to:this.oEC.ParseDate(t)}}};e.ECDragDropControl=function(e){this.oEC=e.calendar;this.enabled=true};e.ECDragDropControl.prototype={Reset:function(){jsDD.Reset()},RegisterDay:function(e){if(!this.enabled)return;var t=this;jsDD.registerDest(e);e.onbxdestdragfinish=function(i,s,o){if(t.oDiv){var n=parseInt(t.oDiv.getAttribute("data-bx-event-ind")),a=new Date(t.oEC.activeDateDaysAr[t.oEC.GetDayIndexByElement(e.parentNode)].getTime());if(!isNaN(n)&&t.oEC.arEvents[n])t.MoveEventToNewDate(t.oEC.arEvents[n],a,"day");BX.removeClass(e,"bxc-day-drag")}t.OnDragFinish();return true};e.onbxdestdraghover=function(i,s,o){if(t.oDiv)BX.addClass(e,"bxc-day-drag")};e.onbxdestdraghout=function(i,s,o){if(t.oDiv)BX.removeClass(e,"bxc-day-drag")}},RegisterTitleDay:function(e,t,i){if(!this.enabled)return;var s=this;jsDD.registerDest(e);jsDD.registerDest(t);e.onbxdestdragfinish=t.onbxdestdragfinish=function(o,n,a){if(s.oDiv){var r=parseInt(s.oDiv.getAttribute("data-bx-event-ind")),l=parseInt(e.getAttribute("data-bx-day-ind")),h=s.oEC.Tabs[i].arDays[l],c=new Date;c.setFullYear(h.year,h.month,h.date);if(!isNaN(r)&&s.oEC.arEvents[r])s.MoveEventToNewDate(s.oEC.arEvents[r],c,"day")}BX.removeClass(e,"bxc-day-drag");BX.removeClass(t,"bxc-day-drag");s.OnDragFinish();return true};e.onbxdestdraghover=t.onbxdestdraghover=function(i,s,o){BX.addClass(e,"bxc-day-drag");BX.addClass(t,"bxc-day-drag")};e.onbxdestdraghout=t.onbxdestdraghout=function(i,s,o){BX.removeClass(e,"bxc-day-drag");BX.removeClass(t,"bxc-day-drag")}},RegisterTimeline:function(e,t){if(!this.enabled)return;var i=this;jsDD.registerDest(e);e.onbxdestdragfinish=function(s,o,n){if(i.oDiv){var a=parseInt(i.oDiv.getAttribute("data-bx-event-ind"));if(isNaN(a)||!i.oEC.arEvents[a])return;var r=i.oEC.arEvents[a];if(s.getAttribute("data-bx-event-resizer")=="Y"){var l=parseInt(i.oDiv.getAttribute("data-bx-original-height"),10),h=i.oDiv.offsetHeight-l,c=parseInt((h-1)/40*3600);i.ResizeEventTimeline(r,c)}else{var d=i.oDiv.getAttribute("data-bx-day-index");if(d!=undefined&&t.arDays[d]){var p=t.arDays[d],u=parseInt(i.oDiv.style.top,10)-BX.pos(e).top+e.scrollTop,m=Math.max((u-1)/42*60,0);m=Math.round(m/10)*10;var v=parseInt(m/60,10),f=Math.max(m-v*60,0),C=new Date;C.setFullYear(p.year,p.month,p.date);C.setHours(v);C.setMinutes(f);C.setSeconds(0);if(i.oDiv.getAttribute("data-bx-title-event")){r.DT_SKIP_TIME="N";i.MoveEventToNewDate(r,C,"timeline",36e5)}else i.MoveEventToNewDate(r,C,"timeline")}}}i.OnDragFinish();return true};e.onbxdestdraghover=function(s,o,n){i.timeLineEventOver=true;i.PrepareTimelineDaysPos(e,t);BX.addClass(e,"bxec-timeline-div-drag")};e.onbxdestdraghout=function(t,s,o){i.ClearTimeline(e)};e.onbxdestdragstop=function(t,s,o){i.ClearTimeline(e)}},ClearTimeline:function(e){this.timeLineEventOver=false;BX.removeClass(e,"bxec-timeline-div-drag");jsDD.current_dest_index=false},GetTimelinePos:function(e){return e.__bxpos},PrepareTimelineDaysPos:function(e,t){this.timeLinePos=this.GetTimelinePos(e);var i=t.pTimelineTable.rows[0];var s,o,n;this.arDays=[];for(var o=1;o<i.cells.length;o++){s=i.cells[o];n=BX.pos(s);n._left=n.left-this.timeLinePos[0];n._right=n.right-this.timeLinePos[0];this.arDays.push(n)}if(!this.activeDayDrop){this.activeDayDrop=BX.create("DIV",{props:{className:"bxec-timeline-active-day-drag-selector"}});this.activeDayDrop.style.height=parseInt(t.pTimelineTable.offsetHeight,10)+"px"}if(this.activeDayDrop.parentNode!=e)e.appendChild(this.activeDayDrop);if(!this.timelineDragOverlay){this.timelineDragOverlay=BX.create("DIV",{props:{className:"bxec-timeline-drag-overlay"}});this.timelineDragOverlay.style.height=parseInt(t.pTimelineTable.offsetHeight,10)+"px"}if(this.timelineDragOverlay.parentNode!=e)e.appendChild(this.timelineDragOverlay)},CheckTimelineOverPos:function(e,t){if(this.timeLineEventOver){this.activeDayDrop.style.display="block";var i,s=this.arDays.length;for(i=0;i<s;i++){if(e>=this.arDays[i].left&&e<=this.arDays[i].right){this.activeDayDrop.style.left=this.arDays[i]._left-1+"px";this.activeDayDrop.style.width=this.arDays[i].width-1+"px";this.oDiv.style.width=this.arDays[i].width-5+"px";this.oDiv.style.left=this.arDays[i].left+1+"px";this.oDiv.style.top=t-10+"px";this.oDiv.setAttribute("data-bx-day-index",i);break}}}else{if(this.activeDayDrop)this.activeDayDrop.style.display="none"}},RegisterEvent:function(e,t,i){if(!this.enabled)return;var s=t["~TYPE"]=="tasks"||!this.oEC.Event.CanDo(t,"edit")||this.oEC.Event.IsRecursive(t);if(this.oEC.Event.IsMeeting(t)&&!this.oEC.Event.IsHost(t))s=true;if(t.PRIVATE_EVENT&&!this.oEC.Personal())s=true;var o=this;jsDD.registerObject(e);e.setAttribute("data-bx-title-event",true);e.onbxdragstart=function(){if(s){o.oDiv=null;document.body.style.cursor="default";o.ShowDenyNotice(e,t)}else{o.oDiv=e.cloneNode(true);o.oDiv.className="bxec-event bxec-event-drag";document.body.appendChild(o.oDiv);o.oDiv.style.top="-1000px";o.oDiv.style.left="-1000px";var i=o.oEC.MoreEventsWin;if(i){i.close();i.destroy();i=null}}};e.onbxdrag=function(e,t){if(o.oDiv){o.oDiv.style.left=e-20+"px";o.oDiv.style.top=t-10+"px";if(i=="week_title"){o.CheckTimelineOverPos(e,t)}}};e.onbxdragstop=function(e,t){if(o.oDiv){setTimeout(function(){if(o.oDiv&&o.oDiv.parentNode){o.oDiv.parentNode.removeChild(o.oDiv);o.oDiv=null}},100)}o.OnDragFinish()};e.onbxdragfinish=function(e,t,i){o.OnDragFinish();return true}},RegisterTimelineEvent:function(e,t,i){if(!this.enabled)return;var s=t["~TYPE"]=="tasks"||!this.oEC.Event.CanDo(t,"edit")||this.oEC.Event.IsRecursive(t);var o=this;jsDD.registerObject(e);e.onbxdragstart=function(){if(s){o.oDiv=null;document.body.style.cursor="default";o.ShowDenyNotice(e,t)}else{o.oDiv=e.cloneNode(true);o.oDiv.className="bxec-tl-event bxec-event-drag";document.body.appendChild(o.oDiv);o.oDiv.style.top="-1000px";o.oDiv.style.left="-1000px"}};e.onbxdrag=function(e,t){if(!o.oDiv)return;if(o.timeLineEventOver){var i,s=o.arDays.length;for(i=0;i<s;i++){if(e>=o.arDays[i].left&&e<=o.arDays[i].right){o.oDiv.style.width=o.arDays[i].width-15+"px";o.oDiv.style.left=o.arDays[i].left+1+"px";o.oDiv.style.top=t-10+"px";o.oDiv.setAttribute("data-bx-day-index",i);break}}}};e.onbxdragstop=function(e,t){o.OnDragFinish();if(!o.oDiv)return;setTimeout(function(){if(o.oDiv&&o.oDiv.parentNode){o.oDiv.parentNode.removeChild(o.oDiv);o.oDiv=null}},100)};e.onbxdragfinish=function(e,t,i){o.OnDragFinish()}},RegisterTimelineEventResizer:function(t,i,s,o){if(!this.enabled)return;var n=s["~TYPE"]=="tasks"||!this.oEC.Event.CanDo(s,"edit")||this.oEC.Event.IsRecursive(s);t.setAttribute("data-bx-event-resizer","Y");BX.bind(t,"mousedown",function(t){var s=BX.GetWindowSize();t=t||e.event;a.timelineResize={oDiv:i,startY:t.clientY+s.scrollTop,height:parseInt(i.offsetHeight)}});var a=this;jsDD.registerObject(t);t.onbxdragstart=function(){if(n){a.oDiv=null;document.body.style.cursor="default";a.ShowDenyNotice(t,s);return}document.body.style.cursor="s-resize";a.oDiv=i;BX.removeClass(a.oDiv,"bxec-tl-ev-hlt")};t.onbxdrag=function(e,t){if(a.oDiv&&a.timeLineEventOver){var i=a.timelineResize.height+t-a.timelineResize.startY+5;if(i<=0)i=5;a.timelineResize.oDiv.style.height=i+"px"}};t.onbxdragstop=function(e,t){a.OnDragFinish();if(!a.oDiv)return};t.onbxdragfinish=function(e,t,i){a.OnDragFinish()}},ResizeEventTimeline:function(e,t){e.DT_LENGTH=Math.max(parseInt(e.DT_LENGTH,10)+t,0);e.DT_LENGTH=Math.round(e.DT_LENGTH/600)*600;e.dateTo.setTime(e.dateFrom.getTime()+e.DT_LENGTH*1e3);e.DATE_TO=this.oEC.FormatDateTime(e.dateTo);this.oEC.Request({postData:this.oEC.GetReqData("move_event_to_date",{id:e.ID,date_from:e.DATE_FROM,date_to:e.DATE_TO,section:e.SECT_ID,skip_time:e.DT_SKIP_TIME}),errorText:EC_MESS.EventSaveError,handler:function(e){return true}});this.oEC.Event.PreHandle(e);this.oEC.Event.Display()},MoveEventToNewDate:function(e,t,i,s){var o=864e5,n;if(i=="day"&&e.DT_SKIP_TIME=="N"){t.setHours(e.dateFrom.getHours()||0);t.setMinutes(e.dateFrom.getMinutes()||0)}if(s){n=new Date(t.getTime()+s)}else if(e.DT_SKIP_TIME=="N"){n=new Date(t.getTime()+e.DT_LENGTH*1e3)}else if(e.DT_SKIP_TIME=="Y"){n=new Date(t.getTime()+e.DT_LENGTH*1e3-o)}e.DATE_FROM=e.DT_SKIP_TIME=="Y"?this.oEC.FormatDate(t):this.oEC.FormatDateTime(t);e.DATE_TO=e.DT_SKIP_TIME=="Y"?this.oEC.FormatDate(n):this.oEC.FormatDateTime(n);this.oEC.Request({postData:this.oEC.GetReqData("move_event_to_date",{id:e.ID,date_from:e.DATE_FROM,date_to:e.DATE_TO,section:e.SECT_ID,skip_time:e.DT_SKIP_TIME,timezone:e.TZ_FROM!=this.oEC.arConfig.userTimezoneName||e.TZ_TO!=this.oEC.arConfig.userTimezoneName?this.oEC.arConfig.userTimezoneName:""}),errorText:EC_MESS.EventSaveError,handler:function(e){return true}});if(e.DT_SKIP_TIME=="N"){e["~USER_OFFSET_FROM"]=0;e["~USER_OFFSET_TO"]=0;e.TZ_FROM=e.TZ_TO=this.oEC.arConfig.userTimezoneName}if(s!=undefined)e.DT_LENGTH=parseInt(s,10)/1e3;this.oEC.Event.PreHandle(e);this.oEC.Event.Display()},ShowDenyNotice:function(e,t){if(!this.pNotice)this.pNotice=document.body.appendChild(BX.create("DIV",{props:{className:"bxec-event-drag-deny-notice"}}));if(this.bNoticeShown)this.HideDenyNotice();if(t["~TYPE"]=="tasks")this.pNotice.innerHTML=EC_MESS.ddDenyTask;else if(this.oEC.Event.IsRecursive(t))this.pNotice.innerHTML=EC_MESS.ddDenyRepeted;else this.pNotice.innerHTML=EC_MESS.ddDenyEvent;var i=BX.align(e,250,50,"top");this.pNotice.style.left=i.left+"px";this.pNotice.style.top=i.top+"px";this.pNotice.style.display="block";this.bNoticeShown=true;BX.bind(document,"mouseup",BX.proxy(this.HideDenyNotice,this))},HideDenyNotice:function(){if(this.bNoticeShown){this.bNoticeShown=false;if(this.pNotice)this.pNotice.style.display="none";BX.unbind(document,"mouseup",BX.proxy(this.HideDenyNotice,this))}},OnDragFinish:function(){},IsDragDropNow:function(){return jsDD.bStarted}}})(window);
//# sourceMappingURL=cal-controlls.map.js