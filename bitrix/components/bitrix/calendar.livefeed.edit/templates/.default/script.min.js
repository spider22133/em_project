(function(e){e.EditEventManager=function(e){this.config=e;this.id=this.config.id;this.bAMPM=this.config.bAMPM;this.DATE_FORMAT=BX.date.convertBitrixFormat(BX.message("FORMAT_DATE"));this.DATETIME_FORMAT=BX.date.convertBitrixFormat(BX.message("FORMAT_DATETIME"));if(this.DATETIME_FORMAT.substr(0,this.DATE_FORMAT.length)==this.DATE_FORMAT)this.TIME_FORMAT=BX.util.trim(this.DATETIME_FORMAT.substr(this.DATE_FORMAT.length));else this.TIME_FORMAT=BX.date.convertBitrixFormat(this.bAMPM?"H:MI:SS T":"HH:MI:SS");this.TIME_FORMAT_SHORT=this.TIME_FORMAT.replace(":s","");this.bFullDay=false;this.bReminder=false;this.bAdditional=false;var t=this;BX.addCustomEvent("onCalendarLiveFeedShown",function(){t.Init();t.defaultValues={remind:{count:15,type:"min"}};t.config.arEvent=t.HandleEvent(t.config.arEvent);t.ShowFormData(t.config.arEvent)})};e.EditEventManager.prototype={Init:function(){var t=this;this.pFromToCont=BX("feed-cal-from-to-cont"+this.id);this.pFromDate=BX("feed-cal-event-from"+this.id);this.pToDate=BX("feed-cal-event-to"+this.id);this.pFromTime=BX("feed_cal_event_from_time"+this.id);this.pToTime=BX("feed_cal_event_to_time"+this.id);this.pFullDay=BX("event-full-day"+this.id);this.pDefTimezone=BX("feed-cal-tz-def"+this.id);this.pDefTimezoneWrap=BX("feed-cal-tz-def-wrap"+this.id);this.pFromTz=BX("feed-cal-tz-from"+this.id);this.pToTz=BX("feed-cal-tz-to"+this.id);this.pDefTimezone.onchange=BX.proxy(this.DefaultTimezoneOnChange,this);this.pTzOuterCont=BX("feed-cal-tz-cont-outer"+this.id);this.pTzSwitch=BX("feed-cal-tz-switch"+this.id);this.pTzCont=BX("feed-cal-tz-cont"+this.id);this.pTzInnerCont=BX("feed-cal-tz-inner-cont"+this.id);this.pTzSwitch.onclick=BX.proxy(this.TimezoneSwitch,this);this.pFromTz.onchange=BX.proxy(this.TimezoneFromOnChange,this);this.pToTz.onchange=BX.proxy(this.TimezoneToOnChange,this);new BX.CHint({parent:BX("feed-cal-tz-tip"+this.id),hint:t.config.message.eventTzHint});new BX.CHint({parent:BX("feed-cal-tz-def-tip"+this.id),hint:t.config.message.eventTzDefHint});this.pReminderCont=BX("feed-cal-reminder-cont"+this.id);this.pReminder=BX("event-reminder"+this.id);this.pEventName=BX("feed-cal-event-name"+this.id);this.pForm=this.pEventName.form;this.pLocation=BX("event-location"+this.id);this.pImportance=BX("event-importance"+this.id);this.pAccessibility=BX("event-accessibility"+this.id);this.pSection=BX("event-section"+this.id);this.pRemCount=BX("event-remind_count"+this.id);this.pRemType=BX("event-remind_type"+this.id);if(this.config.meetingRooms){this.Location=new BXInputPopup({id:this.id+"_loc_mr",values:this.config.meetingRooms,input:this.pLocation,defaultValue:this.config.message.SelectMR,openTitle:this.config.message.OpenMRPage,className:"calendar-inp calendar-inp-time calendar-inp-loc",noMRclassName:"calendar-inp calendar-inp-time calendar-inp-loc"});this.Loc={};BX.addCustomEvent(this.Location,"onInputPopupChanged",BX.proxy(this.LocationOnChange,this));BX.addClass(this.pLocation,"calendar-inp-time");this.Location.Set(false,"")}this.pFullDay.onclick=BX.proxy(this.FullDay,this);this.pReminder.onclick=BX.proxy(this.Reminder,this);BX.bind(this.pForm,"submit",BX.proxy(this.OnSubmit,this));BX("feed-cal-additional-show").onclick=BX("feed-cal-additional-hide").onclick=BX.proxy(this.ShowAdditionalParams,this);this.InitDateTimeControls();var i=e["BXHtmlEditor"].Get(this.config.editorId);if(i&&i.IsShown()){this.CustomizeHtmlEditor(i)}else{BX.addCustomEvent(e["BXHtmlEditor"],"OnEditorCreated",function(e){if(e.id==t.config.editorId){t.CustomizeHtmlEditor(e)}})}this.pRepeat=BX("event-repeat"+this.id);this.pRepeatDetails=BX("event-repeat-details"+this.id);this.RepeatDiapTo=BX("event-repeat-to"+this.id);this.RepeatDiapToValue=BX("event-repeat-to-value"+this.id);this.pRepeat.onchange=function(){var e=this.value;t.pRepeatDetails.className="feed-cal-repeat-details feed-cal-repeat-details-"+e.toLowerCase()};this.pRepeat.onchange();this.RepeatDiapTo.onclick=function(){BX.calendar({node:this,field:this,bTime:false});BX.focus(this)};this.RepeatDiapTo.onfocus=function(){if(!this.value||this.value==t.config.message.NoLimits)this.title=this.value="";this.style.color="#000000"};this.RepeatDiapTo.onblur=this.RepeatDiapTo.onchange=function(){if(this.value&&this.value!=t.config.message.NoLimits){var e=BX.parseDate(this.value);if(e&&e.getTime)t.RepeatDiapToValue.value=BX.date.getServerTimestamp(e.getTime());this.style.color="#000000";this.title="";return}this.title=this.value=t.config.message.NoLimits;this.style.color="#C0C0C0"};this.RepeatDiapTo.onchange();this.eventNode=BX("div"+this.config.editorId);if(this.eventNode){BX.onCustomEvent(this.eventNode,"OnShowLHE",["justShow"])}},CustomizeHtmlEditor:function(e){if(e.toolbar.controls&&e.toolbar.controls.spoiler){BX.remove(e.toolbar.controls.spoiler.pCont)}},InitDateTimeControls:function(){var i=this;this.pFromDate.onclick=function(){BX.calendar({node:this.parentNode,field:this,bTime:false})};this.pToDate.onclick=function(){BX.calendar({node:this.parentNode,field:this,bTime:false})};this.pFromDate.onchange=function(){if(i._FromDateValue){var e=BX.parseDate(i._FromDateValue),a=BX.parseDate(i.pFromDate.value),n=BX.parseDate(i.pToDate.value);if(a){var s=n.getTime()-e.getTime();if(s<0)s=0;n=new Date(a.getTime()+s);if(n)i.pToDate.value=t(n.getDate(),n.getMonth()+1,n.getFullYear())}}i._FromDateValue=i.pFromDate.value};this.pFromTime.parentNode.onclick=this.pFromTime.onclick=e["bxShowClock_"+"feed_cal_event_from_time"+this.id];this.pToTime.parentNode.onclick=this.pToTime.onclick=e["bxShowClock_"+"feed_cal_event_to_time"+this.id];this.pFromTime.onchange=function(){var e=i.ParseDate(BX.util.trim(i.pFromDate.value)+" "+BX.util.trim(i.pFromTime.value));if(i.pToDate.value=="")i.pToDate.value=i.pFromDate.value;var t=i.ParseDate(BX.util.trim(i.pToDate.value)+" "+BX.util.trim(i.pToTime.value));if(i._FromTimeValue){var a=i.ParseDate(BX.util.trim(i.pFromDate.value)+" "+i._FromTimeValue);var n=t.getTime()-a.getTime();if(n<0)n=36e5;var s=new Date(e.getTime()+n);i.pToDate.value=i.FormatDate(s);i.pToTime.value=i.FormatTime(s)}i._FromTimeValue=i.pFromTime.value}},OnSubmit:function(t){if(this.Loc.NEW.substr(0,5)=="ECMR_"&&!this.bLocationChecked&&e.setBlogPostFormSubmitted){var i=this,a=this.ParseDate(BX.util.trim(this.pFromDate.value)+" "+BX.util.trim(this.pFromTime.value)),n=this.ParseDate(BX.util.trim(this.pToDate.value)+" "+BX.util.trim(this.pToTime.value));top.BXCRES_Check=null;this.CheckMeetingRoom({from:this.FormatDateTime(a),to:this.FormatDateTime(n),location:this.Loc.NEW},function(){setTimeout(function(){var e=top.BXCRES_Check;if((!e||e=="reserved")&&BX("blog-submit-button-save")){setBlogPostFormSubmitted(false);BX.removeClass(BX("blog-submit-button-save"),"feed-add-button-load")}if(!e)return alert(i.config.message.MRReserveErr);if(e=="reserved")return alert(i.config.message.MRNotReservedErr);i.bLocationChecked=true;BX("event-location-new"+i.id).name=i.pLocation.name;BX("event-location-new"+i.id).value=i.Loc.NEW;i.pLocation.name="";setBlogPostFormSubmitted(false);submitBlogPostForm()},100)});return BX.PreventDefault(t)}},HandleEvent:function(e){if(e){e.DT_FROM_TS=BX.date.getBrowserTimestamp(e.DT_FROM_TS);e.DT_TO_TS=BX.date.getBrowserTimestamp(e.DT_TO_TS);if(e.DT_FROM_TS>e.DT_TO_TS)e.DT_FROM_TS=e.DT_TO_TS;if(e.RRULE&&e.RRULE.FREQ&&e.RRULE.FREQ!="NONE"){e["~DT_FROM_TS"]=BX.date.getBrowserTimestamp(e["~DT_FROM_TS"]);e["~DT_TO_TS"]=BX.date.getBrowserTimestamp(e["~DT_TO_TS"]);if(e.RRULE&&e.RRULE.UNTIL)e.RRULE.UNTIL=BX.date.getBrowserTimestamp(e.RRULE.UNTIL)}}return e},ShowFormData:function(e){var t=false;if(!e||!e.ID){t=true;e={}}this.pEventName.value=e.NAME||"";this.linkFromToTz=true;this.linkFromToDefaultTz=true;if(this.config.userTimezoneName){this.pDefTimezoneWrap.style.display="none";this.pDefTimezone.value=this.config.userTimezoneName;this.pFromTz.value=this.pToTz.value=this.config.userTimezoneName}else{this.pDefTimezoneWrap.style.display="";this.pFromTz.value=this.pToTz.value=this.pDefTimezone.value=this.config.userTimezoneDefault||""}var i=this.GetUsableDateTime((new Date).getTime(),30);var a=this.GetUsableDateTime(i.getTime()+36e5,30);this.pFromDate.value=this.FormatDate(i);this.pToDate.value=this.FormatDate(a);this.pFromTime.value=this.FormatTime(i);this.pToTime.value=this.FormatTime(a);this._FromDateValue=this.pFromDate.value;this._FromTimeValue=this.pFromTime.value;if(this.config.userTimezoneName){this.pDefTimezoneWrap.style.display="none";this.pDefTimezone.value=this.config.userTimezoneName;this.pFromTz.value=this.pToTz.value=this.config.userTimezoneName}else{this.pDefTimezoneWrap.style.display="";this.pFromTz.value=this.pToTz.value=this.pDefTimezone.value=this.config.userTimezoneDefault||""}this.pFullDay.checked=e.DT_SKIP_TIME=="Y";this.FullDay(false,e.DT_SKIP_TIME!=="Y");if(t){this.pLocation.value="";if(this.Location){this.Location.Set(false,"")}this.pImportance.value="normal";this.pAccessibility.value="busy";if(this.pSection.options&&this.pSection.options.length>0)this.pSection.value=this.pSection.options[0].value;this.pReminder.checked=!!this.defaultValues.remind;this.pRemCount.value=this.defaultValues.remind&&this.defaultValues.remind.count||"15";this.pRemType.value=this.defaultValues.remind&&this.defaultValues.remind.type||"min"}else{this.pLocation.value=e.LOCATION;this.pImportance.value=e.IMPORTANCE;this.pAccessibility.value=e.ACCESSIBILITY;this.pSection.value=e.SECT_ID;this.pReminder.checked=e.REMIND&&e.REMIND[0];this.pRemCount.value=e.REMIND[0].count;this.pRemType.value=e.REMIND[0].type}this.Reminder(false,true);var n=this;setTimeout(function(){BX.focus(n.pEventName)},100)},FullDay:function(e,t){if(t==undefined)t=!this.bFullDay;if(t)BX.removeClass(this.pFromToCont,"feed-cal-full-day");else BX.addClass(this.pFromToCont,"feed-cal-full-day");this.bFullDay=t},Reminder:function(e,t){if(t==undefined)t=!this.bReminder;this.pReminderCont.className=t?"feed-event-reminder":"feed-event-reminder-collapsed";this.bReminder=t},ShowAdditionalParams:function(){var e=!this.bAdditional;if(!this.pAdditionalCont)this.pAdditionalCont=BX("feed-cal-additional");if(e)BX.removeClass(this.pAdditionalCont,"feed-event-additional-hidden");else BX.addClass(this.pAdditionalCont,"feed-event-additional-hidden");this.bAdditional=e},ParseTime:function(e){var t,i,a;e=BX.util.trim(e);e=e.toLowerCase();if(this.bAMPM){var n="pm";if(e.indexOf("am")!=-1)n="am";e=e.replace(/[^\d:]/gi,"");a=e.split(":");t=parseInt(a[0]||0,10);i=parseInt(a[1]||0,10);if(t==12){if(n=="am")t=0;else t=12}else if(t!=0){if(n=="pm"&&t<12){t+=12}}}else{a=e.split(":");t=a[0]||0;i=a[1]||0;if(t.toString().length>2)t=parseInt(t.toString().substr(0,2));i=parseInt(i)}if(isNaN(t)||t>24)t=0;if(isNaN(i)||i>60)i=0;return{h:t,m:i}},TimezoneSwitch:function(){if(this.pTzCont.offsetHeight>0){this.pTzCont.style.height=0;BX.removeClass(this.pTzOuterCont,"feed-ev-timezone-outer-wrap-opened")}else{this.pTzCont.style.height=this.pTzInnerCont.offsetHeight+"px";BX.addClass(this.pTzOuterCont,"feed-ev-timezone-outer-wrap-opened")}},DefaultTimezoneOnChange:function(){var e=this.pDefTimezone.value;BX.userOptions.save("calendar","timezone_name","timezone_name",e);if(this.linkFromToDefaultTz)this.pToTz.value=this.pFromTz.value=this.pDefTimezone.value},TimezoneFromOnChange:function(){if(this.linkFromToTz)this.pToTz.value=this.pFromTz.value;this.linkFromToDefaultTz=false},TimezoneToOnChange:function(){this.linkFromToTz=false;this.linkFromToDefaultTz=false},FormatDate:function(e){return BX.date.format(this.DATE_FORMAT,e.getTime()/1e3)},FormatTime:function(e,t){return BX.date.format(t===true?this.TIME_FORMAT:this.TIME_FORMAT_SHORT,e.getTime()/1e3)},FormatDateTime:function(e){return BX.date.format(this.DATETIME_FORMAT,e.getTime()/1e3)},GetUsableDateTime:function(e,t){var i=(t||10)*60*1e3;e=Math.ceil(e/i)*i;return new Date(e)},ParseDate:function(e,t){var i=false;var a=BX.message("FORMAT_DATETIME");if(t!==false)a=a.replace(":SS","");if(BX.type.isNotEmptyString(e)){var n="";for(l=1;l<=12;l++){n=n+"|"+BX.message("MON_"+l)}var s=new RegExp("([0-9]+|[a-z]+"+n+")","ig");var o=e.match(s),r=BX.message("FORMAT_DATE").match(/(DD|MI|MMMM|MM|M|YYYY)/gi),l,h,m=[],d=[],c={};if(!o)return null;if(o.length>r.length){r=a.match(/(DD|MI|MMMM|MM|M|YYYY|HH|H|SS|TT|T|GG|G)/gi)}for(l=0,h=o.length;l<h;l++){if(BX.util.trim(o[l])!=""){m[m.length]=o[l]}}for(l=0,h=r.length;l<h;l++){if(BX.util.trim(r[l])!=""){d[d.length]=r[l]}}var u=BX.util.array_search("MMMM",d);if(u>0){m[u]=BX.getNumMonth(m[u]);d[u]="MM"}else{u=BX.util.array_search("M",d);if(u>0){m[u]=BX.getNumMonth(m[u]);d[u]="MM"}}for(l=0,h=d.length;l<h;l++){var f=d[l].toUpperCase();c[f]=f=="T"||f=="TT"?m[l]:parseInt(m[l],10)}if(c["DD"]>0&&c["MM"]>0&&c["YYYY"]>0){var p=new Date;if(i){p.setUTCDate(1);p.setUTCFullYear(c["YYYY"]);p.setUTCMonth(c["MM"]-1);p.setUTCDate(c["DD"]);p.setUTCHours(0,0,0)}else{p.setDate(1);p.setFullYear(c["YYYY"]);p.setMonth(c["MM"]-1);p.setDate(c["DD"]);p.setHours(0,0,0)}if((!isNaN(c["HH"])||!isNaN(c["GG"])||!isNaN(c["H"])||!isNaN(c["G"]))&&!isNaN(c["MI"])){if(!isNaN(c["H"])||!isNaN(c["G"])){var T=(c["T"]||c["TT"]||"am").toUpperCase()=="PM";var v=parseInt(c["H"]||c["G"]||0,10);if(T){c["HH"]=v+(v==12?0:12)}else{c["HH"]=v<12?v:0}}else{c["HH"]=parseInt(c["HH"]||c["GG"]||0,10)}if(isNaN(c["SS"]))c["SS"]=0;if(i){p.setUTCHours(c["HH"],c["MI"],c["SS"])}else{p.setHours(c["HH"],c["MI"],c["SS"])}}return p}}},LocationOnChange:function(e,t,i){this.pLocation.className="calendar-inp calendar-inp-time calendar-inp-loc";if(t===false){this.Loc.NEW=i||""}else{this.Loc.NEW="ECMR_"+this.config.meetingRooms[t].ID}},CheckMeetingRoom:function(e,t){e.bx_event_calendar_check_meeting_room="Y";e.sessid=BX.bitrix_sessid();BX.ajax.get("/bitrix/components/bitrix/calendar.livefeed.edit/ajax_action.php",e,function(){if(t&&typeof t=="function")t();return true})}};e.BXEvDestSetLinkName=function(e){if(BX.SocNetLogDestination.getSelectedCount(e)<=0)BX("feed-event-dest-add-link").innerHTML=BX.message("BX_FPD_LINK_1");else BX("feed-event-dest-add-link").innerHTML=BX.message("BX_FPD_LINK_2")};e.BXEvDestSelectCallback=function(e,t,i){var a=t,n="S";if(t=="sonetgroups")n="SG";else if(t=="groups"){n="UA";a="all-users"}else if(t=="users")n="U";else if(t=="department")n="DR";BX("feed-event-dest-item").appendChild(BX.create("span",{attrs:{"data-id":e.id},props:{className:"feed-event-destination feed-event-destination-"+a},children:[BX.create("input",{attrs:{type:"hidden",name:"EVENT_PERM["+n+"][]",value:e.id}}),BX.create("span",{props:{className:"feed-event-destination-text"},html:e.name}),BX.create("span",{props:{className:"feed-event-del-but"},events:{click:function(i){BX.SocNetLogDestination.deleteItem(e.id,t,destinationFormName);BX.PreventDefault(i)},mouseover:function(){BX.addClass(this.parentNode,"feed-event-destination-hover")},mouseout:function(){BX.removeClass(this.parentNode,"feed-event-destination-hover")}}})]}));BX("feed-event-dest-input").value="";BXEvDestSetLinkName(destinationFormName)};e.BXEvDestUnSelectCallback=function(e,t,i){var a=BX.findChildren(BX("feed-event-dest-item"),{attribute:{"data-id":""+e.id+""}},true);if(a!=null){for(var n=0;n<a.length;n++)BX.remove(a[n])}BX("feed-event-dest-input").value="";BXEvDestSetLinkName(destinationFormName)};e.BXEvDestOpenDialogCallback=function(){BX.style(BX("feed-event-dest-input-box"),"display","inline-block");BX.style(BX("feed-event-dest-add-link"),"display","none");BX.focus(BX("feed-event-dest-input"))};e.BXEvDestCloseDialogCallback=function(){if(!BX.SocNetLogDestination.isOpenSearch()&&BX("feed-event-dest-input").value.length<=0){BX.style(BX("feed-event-dest-input-box"),"display","none");BX.style(BX("feed-event-dest-add-link"),"display","inline-block");BXEvDestDisableBackspace()}};e.BXEvDestCloseSearchCallback=function(){if(!BX.SocNetLogDestination.isOpenSearch()&&BX("feed-event-dest-input").value.length>0){BX.style(BX("feed-event-dest-input-box"),"display","none");BX.style(BX("feed-event-dest-add-link"),"display","inline-block");BX("feed-event-dest-input").value="";BXEvDestDisableBackspace()}};e.BXEvDestDisableBackspace=function(){if(BX.SocNetLogDestination.backspaceDisable||BX.SocNetLogDestination.backspaceDisable!=null)BX.unbind(e,"keydown",BX.SocNetLogDestination.backspaceDisable);BX.bind(e,"keydown",BX.SocNetLogDestination.backspaceDisable=function(e){if(e.keyCode==8){BX.PreventDefault(e);return false}});setTimeout(function(){BX.unbind(e,"keydown",BX.SocNetLogDestination.backspaceDisable);BX.SocNetLogDestination.backspaceDisable=null},5e3)};e.BXEvDestSearchBefore=function(e){return BX.SocNetLogDestination.searchBeforeHandler(e,{formName:destinationFormName,inputId:"feed-event-dest-input"})};e.BXEvDestSearch=function(e){return BX.SocNetLogDestination.searchHandler(e,{formName:destinationFormName,inputId:"feed-event-dest-input",linkId:"feed-event-dest-add-link",sendAjax:true})};function t(e,t,a){var n=BX.message("FORMAT_DATE");n=n.replace(/YY(YY)?/gi,a);n=n.replace(/MMMM/gi,BX.message("MONTH_"+this.Number(t)));n=n.replace(/MM/gi,i(t));n=n.replace(/M/gi,BX.message("MON_"+this.Number(t)));n=n.replace(/DD/gi,i(e));return n}function i(e){e=parseInt(e,10);if(isNaN(e))e=0;return e<10?"0"+e.toString():e.toString()}function a(e,t){var i=new Date(e);if(!t){var a=i.getHours()||0,n=i.getMinutes()||0;i={date:i.getDate(),month:i.getMonth()+1,year:i.getFullYear(),bTime:!!(a||n),oDate:i};if(i.bTime){i.hour=a;i.min=n}}return i}function n(e,t){var i=(t||10)*60*1e3;e=Math.ceil(e/i)*i;return a(e)}function s(e,t,i){var a="";if(t==undefined)t="00";else{t=parseInt(t,10);if(isNaN(t))t="00";else{if(t>59)t=59;t=t<10?"0"+t.toString():t.toString()}}e=parseInt(e,10);if(e>24)e=24;if(isNaN(e))e=0;if(i){var n="am";if(e==0){e=12}else if(e==12){n="pm"}else if(e>12){n="pm";e-=12}a=e.toString()+":"+t.toString()+" "+n}else{a=(e<10?"0":"")+e.toString()+":"+t.toString()}return a}})(window);
//# sourceMappingURL=script.map.js